import{r as x,a as V,_ as rt,w as j,v as ct,c as u,b as s,d as M,t as I,F as E,e as H,f as dt,o as f,g as ut,h as ft,i as J,j as X,n as pt,u as gt}from"./index-Dg8YuN2Z.js";async function vt(g){const{sheetId:n,sheetName:i="",deploymentId:_,client:o}=g,{cancel:l,controller:r}=$(15e3);let m=`${`https://script.google.com/macros/s/${_}/exec`}?sheetId=${n}&sheetName=${i}&client=${o}`;const S=await fetch(m,{method:"GET",redirect:"follow",signal:r.signal});return l(),await S.json()}function $(g){const n=new AbortController,i=setTimeout(()=>{n.abort()},g);return{controller:n,cancel:()=>{clearTimeout(i)}}}async function yt(){const{cancel:g,controller:n}=$(15e3),o=await fetch("https://script.google.com/macros/s/AKfycbyRrP5xSt3A_fyTieysOFgv2gljQI2iunJEc0CRijOlOTOXiNesbNX2-GZyRRFVRXFe/exec",{method:"GET",redirect:"follow",signal:n.signal});return g(),await o.json()}const K=[{兑换物品名称:"体力药水(小)",图片:"https://lh3.googleusercontent.com/d/1M_1Zvh24BKTtiz-PkHfPEcpX22wb-kyW=w1000?authuser=0",参数:"item_id=36&cost_type=25&cost=4800&amount=1",备注:"需要将原始抓包数据的store_id与网站提供的参数拼接, 且需要在金币商店中刷出药水的时候才可使用。",版本:"",_imageFields:"图片"},{兑换物品名称:"体力药水(中)",图片:"https://lh3.googleusercontent.com/rd-d/ALs6j_GsgQnuYAfGd63MBHIqYtczmSfQFb37-ZNmHzq4WoYJVFdbmDuIyNfvmtKq-bHIkQYMdMGJln-VmNdPWoR5Qj9la5327jQ--Vxks2yD7RPx5XQCZpyXSWwcZ6gude58bPXyminyvb1EHIbFUh5TrGTDTh0w-mCv3Jlgg6muT_injSk3j1ATTMvsMzXeGuqc5V2tL3OqEW9edOYpbG32rbp8eLg-SV3IdVKjGS92SALGdzVZN2s9-7DrWil4u-XrJCI92hLrwEpdcZWas_YZtnCDi-bJRAsAogCoXdw9FrJAsFyZlSiRXOVpSlJTfKvBZ1v_R_n4e5GUc9LbBcyoQhRWcz4c5LpbmaKZIRObcogDsURculRrkkfVU5EJWo7wJKC12jtzHQdOlY31xvPNgWt3pg64z99jJzIdUMWiPhMDusBrPdqQzBCaDgGZyA5zCtH7IWhnnutgw6-mCdCb7qQ_3rDvuL7iC28g04T0EbT_0kCA_V1MLCFwQ4PrO4wFL4nlxwFvUN1ImLW9BwHzGiNe0Z76QmaaQgKYKiFQJq43fWH3E-MTQwP7JsPut-IIPAZExeiBgOdBUZQPRUh3Frn2ZnasjKVZxw2P7jHOYkA123VSplqatV9fd46vafO4p_oo6UUwjbJGPJ5c3rNqPZW8iK6evf2NnGuOtiWmYOGDaaR5FZizL0IeqKWQrpqHIgVGl_HpmWqsPKczl1dF9_xJv6k6x37U9yVQM9z5DYesT-zB618sxB4k4laakxiGQsnx3ItmGjV_3NBRrcR26WRzYggLWc4emuBoRwZLeU2eNsawqLXpSD3t7BdvukS8kp_qtzQc95ademfsPZitT0kzVj9ri0_2lUVMhhBo3Ka6N5rEp7QIg6J_w0EUcsZbgkWHE1_2lgU43wv9X-arZ1FulD5KLHGXZZAI9GR4lwv6LTyqjB9qOHMi1GNLpCZnHLUnoXJ9KZGDrCdhTjGZifASl4Qq14B3zAPU4FOYkPtm96Sr_vdZYgk=w1000?authuser=0",参数:"amount=1&cost=5000&cost_type=25&item_id=37",备注:"同条件下, 价格比体力药水(小)贵, 与体力药水(大)相同",版本:"",_imageFields:"图片"},{兑换物品名称:"体力药水(大)",图片:"https://lh3.googleusercontent.com/rd-d/ALs6j_HH7F7eZdnIppJzPZNcYnXOkZZqnWMVBktI8FP2uRhLAWY1YK42CuwTUiKCObogvNy3Lc9EeryyraiE2szogs5Yh74sCsm9r-GSYmmcUilqJU28QGN1ToUWlkMiwBVlIuMRv22GlqBo3CMBouXlxggSXyXrnCStsPntrhgC5Rjail73gRsRCyEP_6hF4LTSzvqAb7V7MhaBkh1CHdPx6NEFcBsqb0-c7kddB3Hh5vpELsF7yt-FeDoQAEw0xeKLiQRL4QU7ZcCImLnK_abQJ2GmXm3r_ikdWTEnX0wQSh7qTTAtll_AEJLTiH0j_BHD3-qvHfZZdtqAtN_iKLvjgJfYdY4zNsGVx4rnKsFuYj_Jk4a7Tpx6_rSyZKqjlcclRRqTzp82vG0f0a_UIHxGnLU3t750aa_vo6yWKexdZtzZ24TuTdbRgaxAUldzGryCn2RK1MumUcnn8dOGtE0iLBkUwzVknroZnOzTxGoDNDaGQvSkP8nr4-l9L-2S7oMh_03vHhPuhdDUaC6QS70fPRPzqSYS5MdC3i7LgSABwSbRNuRLMXtYpP5S6ycdPu0ThaDpmJU-wGQtfP6Jd3RUb7xjLadrvNV1iMRXG-NOVY6F5XPce3jAOPVrnmR1L8D5BrDHI6lqmLkVWtDciVkfdwZSXxyTRpMrcwucTl-obGgOfTxwn0EtaMSErXvAm-cBhsZp6cbhXH4sSRjadyzsIhxcOiKcq72Y-YZYgEs1Ao8qsHUBqYEkCfJnKz8gMQTHcTtOJL2xfpZNsKFlvaC1OA79sT0PLAlHD-IoXm9mPfab9wb0Q_WbMAObTb0d_KAVn7u0PGfY5zvgDUGXoIRZo7LkCm1on3zGQWkXeQzRoUTPFGfVoWvCkknkdvpJdiH_6OjQDd00_O9RpF6eT9w3yAfhH-v_HFplUZgTXfJl7O7de0leMMVtH5St7hOqkvTzzW7SHNo8P9GRqHgLbN7sJpaxIKJ_I9l9haBzghkbMG9PcHEeco0deT8=w1000?authuser=0",参数:"amount=1&cost=10000&cost_type=25&item_id=38",备注:"",版本:"",_imageFields:"图片"}];function mt(){const g=x([]),n=V({}),i=x([]);async function _(o){const{action:l,force:r,sheetId:p,sheetName:m="",deploymentId:S,client:k}=o;let b=null;const R=l[m].copy,F=R?R.split(","):[];let D=null;if(r){const v=await vt({sheetId:p,sheetName:m,deploymentId:S,client:JSON.stringify(k)});if(v.success){b=v.data,D=v.extraData;const h=[],w=Object.keys(K[0]).filter(A=>!A.startsWith("_"));let q=b.length-1;for(const A of K){const z={};for(const T of w)z[T]=A[T];const N=A._imageFields;if(q++,N)for(const T of N.split(","))D.imageFields.push(`${q}:${T}`);h.push(z)}b.push(...h),Object.assign(n,v.source),localStorage.setItem("exchange-data",JSON.stringify(v))}}else{const v=JSON.parse(localStorage.getItem("exchange-data")||"{}");b=v.data,D=v.extraData,Object.assign(n,v.source)}const U=D.imageFields||[];i.value=Object.keys(b[0]);const P={};for(const v of U)P[v]=1;for(let v=0;v<b.length;v++){const h=b[v];for(const w of i.value)h[w]={value:h[w]},P[`${v}:${w}`]?h[w].renderImage=!0:F.includes(w)&&(h[w].copy=!0)}g.value=b}return{list:g,fields:i,queryExchangeData:_,spreadsheetSource:n}}function ht(){const g=V({});async function n(i){const o=new Date().getTime();if(!i){const r=localStorage.getItem("exchange-data-config");let p=r?JSON.parse(r):null;if(p&&+p.expiration>o){Object.assign(g,p);return}}const l=await yt();Object.assign(g,l),g.expiration=o+3600*12*1e3,localStorage.setItem("exchange-data-config",JSON.stringify(g)),g.force=!0}return{config:g,queryExchangeDataConfig:n}}const xt={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]},data1:{type:Object,default:()=>({})}},emits:["update:visible","close","refresh"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh",!0)},copy(g){g&&(navigator.clipboard.writeText(g),window.alert("复制成功"))}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]},key2Data1(){return Object.keys(this.data1)}}},bt={class:"modal-content",style:{padding:"0 10px"}},wt={class:"modal-header"},_t={key:0,class:"desc"},kt={key:1,class:"modal-body data-state"},Ot={key:2,class:"modal-body loading-state"},It={key:3,class:"modal-body error-state"},St={class:"error-text"},Tt={key:4,class:"modal-body data-state"},Ct=["src"],Dt=["title"],Ut=["onClick"],At={style:{"margin-top":"10px"}},Rt={key:5,class:"modal-body empty-state"};function Et(g,n,i,_,o,l){return j((f(),u("div",{class:"modal-overlay",onClick:n[3]||(n[3]=dt((...r)=>l.handleOverlayClick&&l.handleOverlayClick(...r),["self"]))},[s("div",bt,[s("div",wt,[s("h2",null,I(i.title),1),s("button",{class:"close-btn",onClick:n[0]||(n[0]=(...r)=>l.closeModal&&l.closeModal(...r))},"×")]),i.description.length?(f(),u("div",_t,[(f(!0),u(E,null,H(i.description,(r,p)=>(f(),u("p",{key:p},I(p+1)+"、"+I(r),1))),128))])):M("",!0),l.key2Data1.length?(f(),u("div",kt,[(f(!0),u(E,null,H(i.data1,(r,p)=>(f(),u("p",{key:p},I(p)+": "+I(r),1))),128))])):i.loading?(f(),u("div",Ot,n[4]||(n[4]=[s("div",{class:"loading"},null,-1),s("p",null,"加载数据中...",-1)]))):i.error?(f(),u("div",It,[s("p",St,"❌ "+I(i.error),1),s("button",{onClick:n[1]||(n[1]=(...r)=>l.refresh&&l.refresh(...r))},"重试")])):i.data&&i.data.length>0?(f(),u("div",Tt,[s("table",null,[s("thead",null,[s("tr",null,[(f(!0),u(E,null,H(l.tabHeaders,(r,p)=>(f(),u("th",{key:p},I(r||`列 ${p+1}`),1))),128))])]),s("tbody",null,[(f(!0),u(E,null,H(i.data,(r,p)=>(f(),u("tr",{key:p},[(f(!0),u(E,null,H(r,(m,S)=>(f(),u("td",{key:S},[m.renderImage?(f(),u("img",{key:0,src:m.value,referrerpolicy:"no-referrer"},null,8,Ct)):(f(),u("div",{key:1,class:"multi-line",title:m.value},[s("span",null,I(m.value),1)],8,Dt)),m.copy?(f(),u("button",{key:2,class:"btn-copy",onClick:k=>l.copy(m.value)}," 复制 ",8,Ut)):M("",!0)]))),128))]))),128))])]),s("div",At,[s("button",{onClick:n[2]||(n[2]=(...r)=>l.refresh&&l.refresh(...r))},"刷新数据")])])):(f(),u("div",Rt,n[5]||(n[5]=[s("p",null,"暂无数据",-1)])))])],512)),[[ct,i.visible]])}const W=rt(xt,[["render",Et],["__scopeId","data-v-e2af90e1"]]),Ht={class:"container1"},Gt={style:{"margin-bottom":"5px"}},Pt={style:{"margin-bottom":"5px"}},qt={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},zt={style:{"margin-bottom":"5px"}},Nt={key:0},Zt={style:{display:"flex","align-items":"flex-start"}},Vt=["disabled"],Ft={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},Lt=["innerHTML"],Z="cost",G="amount",Y="curl",Qt="PowerShell",Q="fetch",Mt={__name:"exchange-api-param-generator",setup(g){const n=x(""),i=x(!1),_=x(""),o=V({type:"",part1:null,part2:null,part3:null,extra:null}),l=x(""),r=x(""),p=x(!1),m=x(!1),S=x(""),k=x(!1),b=x(!1),C=x(!1),R=/[\-]+\w+\s+/,{config:F,queryExchangeDataConfig:D}=ht(),{list:U,queryExchangeData:P,spreadsheetSource:v}=mt(),h=V({message:""}),w=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],q=ut(()=>{if(v.spreadsheetUrl){const a=[...w];return a[0]+=`: ${v.spreadsheetUrl}`,a}return w});function A(){p.value=!0,U.value.length||T(!1)}function z(){return{userAgent:navigator.userAgent}}const N=z();async function T(a){U.value.length&&(U.value.length=0),m.value=!0;try{await D(a),await P({...F,client:N})}catch(t){console.log("拉取数据失败"),console.log(t),S.value="拉取数据失败, 请检查网络或联系管理员"}finally{m.value=!1}}function tt(a,t){let e="--data-raw",y=a.lastIndexOf(e);if(y===-1&&(e="--data-binary",y=a.lastIndexOf(e)),y===-1)return;y+=e.length,t.type=Y,t.part1=a.slice(0,y);let d=a.slice(y);const c=d.match(R);c&&(t.part3=d.slice(c.index),d=d.slice(0,c.index)),d=d.trim().slice(1,-1),t.part2=d}function et(a,t){const e="-Body";let y=a.lastIndexOf(e);if(y===-1)return;y+=e.length,t.type=Qt,t.part1=a.slice(0,y);let d=a.slice(y);const c=d.match(R);c&&(t.part3=d.slice(c.index),d=d.slice(0,c.index)),d=d.trim().slice(1,-1),t.part2=d}function at(a,t){t.type=Q;const e=a.match(/^fetch\((.*?)\);$/s);if(e){const d=e[1],c=d.indexOf(",");if(c!=-1){const O={url:d.slice(1,c-1),options:new Function(`return ${d.slice(c+1)}`)()};t.part1=O.url,t.part2=O.options.body,t.extra=O}}}function st(){let a=n.value;if(!a){window.alert("请输入抓包参数");return}if(a.startsWith(Y)?tt(a,o):a.startsWith("Invoke-WebRequest")?et(a,o):a.startsWith(Q)&&at(a,o),!o.part1||!o.part2)return window.alert("解析失败, 参数格式是否正确?");const t=o.part2.split("&");t.sort();const e={};for(const y of t){let[d,c]=y.split("=");if(d===Z)if(c=decodeURIComponent(c),c.startsWith("[")){c=JSON.parse(c.replace(/\+/g,""));for(const O of c)O.unit=O.value/e[G]}else e.costUnit=c/e[G];e[d]=c}if(!e[G]&&!e[Z]){window.alert("请输入正确的抓包参数");return}o.part2Parsed=e,i.value=!0,_.value=e[G]}function nt(){let a=r.value;if(!a){window.alert("请输入兑换数量");return}if(a=a>>0,a<1){window.alert("请输入正确的兑换数量");return}let t="";const e={...o.part2Parsed};e[G]=a;let y;const d=e[Z];Array.isArray(d)||(y=e.costUnit,delete e.costUnit);for(const c in e)if(c===Z)if(y)t+=`${c}=${y*a}&`;else{const O=[];for(const B of d){const L={...B};L.value=""+B.unit*a,delete L.unit,O.push(L)}t+=`${c}=${encodeURIComponent(JSON.stringify(O))}&`}else t+=`${c}=${e[c]}&`;t=t.slice(0,-1),o.type===Q?(l.value=`fetch('${o.part1}', ${JSON.stringify({...o.extra.options,body:t})});`,o.extra._params=t,k.value=!0):(l.value=`${o.part1} '${t}'`,o.part3&&(l.value+=` ${o.part3}`))}function ot(){l.value&&(navigator.clipboard.writeText(l.value),window.alert("复制成功"))}async function it(){if(!k.value||C.value)return;C.value=!0,setTimeout(()=>{C.value=!1},5e3);const a=await fetch(o.extra.url,{...o.extra.options,body:o.extra._params});h.status_code=a.status;try{const t=await a.json();Object.assign(h,t)}catch(t){console.log(t);try{const e=await a.text();h.respText=e}catch(e){console.log(e)}h.message="请求失败, 网络或参数错误"}finally{b.value=!0}}function lt(){l.value&&(l.value=""),i.value&&(i.value=!1),n.value&&(n.value=""),k.value&&(k.value=!1)}return(a,t)=>(f(),u("div",Ht,[t[6]||(t[6]=s("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),t[7]||(t[7]=s("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),t[8]||(t[8]=s("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),s("div",Gt,[s("div",Pt,[t[4]||(t[4]=s("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),s("div",qt,[j(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),placeholder:"请输入",id:"command",style:{width:"500px","margin-right":"10px"},rows:"6"},null,512),[[X,n.value]])]),s("div",zt,[s("button",{onClick:A,style:{"margin-right":"10px"}},"浏览参数"),s("button",{onClick:st,style:{"margin-right":"10px"}},"解析"),i.value?(f(),u("span",Nt," 成功, 当前兑换数量为: "+I(_.value),1)):M("",!0)])]),s("div",null,[t[5]||(t[5]=s("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),s("div",Zt,[j(s("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e)},null,512),[[X,r.value,void 0,{number:!0}]]),s("button",{onClick:nt,style:{"margin-right":"10px",cursor:"pointer"}},"生成"),s("button",{onClick:ot,style:{"margin-right":"10px",cursor:"pointer"}},"复制"),s("button",{onClick:lt,style:{"margin-right":"10px",cursor:"pointer"}},"清除"),s("button",{disabled:!k.value||C.value,onClick:it,style:pt({cursor:k.value&&!C.value?"pointer":"not-allowed"})},"执行",12,Vt)])]),s("div",Ft,[s("div",{innerHTML:l.value},null,8,Lt)])]),t[9]||(t[9]=ft('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...,</div><div style="font-size:13px;">若是fetch, 则以fetch开头, 并且可直接在当前网页上执行</div>',6)),J(W,{visible:p.value,"onUpdate:visible":t[2]||(t[2]=e=>p.value=e),title:"兑换参数对照表",data:gt(U),description:q.value,onRefresh:T,loading:m.value,error:S.value},null,8,["visible","data","description","loading","error"]),J(W,{visible:b.value,"onUpdate:visible":t[3]||(t[3]=e=>b.value=e),title:"执行fetch命令",data1:h},null,8,["visible","data1"])]))}};export{Mt as default};
