import{r as x,a as M,_ as re,w as B,v as ce,c as u,b as s,d as K,t as I,F as $,e as N,f as de,o as f,g as ue,h as fe,i as G,j as W,n as pe,u as ge}from"./index-BMkBwEAK.js";async function ve(p){const{sheetId:n,sheetName:i="",deploymentId:w,client:o}=p,{cancel:l,controller:r}=Z(15e3);let m=`${`https://script.google.com/macros/s/${w}/exec`}?sheetId=${n}&sheetName=${i}&client=${o}`;const D=await fetch(m,{method:"GET",redirect:"follow",signal:r.signal});return l(),await D.json()}function Z(p){const n=new AbortController,i=setTimeout(()=>{n.abort()},p);return{controller:n,cancel:()=>{clearTimeout(i)}}}async function ye(){const{cancel:p,controller:n}=Z(15e3),o=await fetch("https://script.google.com/macros/s/AKfycbyRrP5xSt3A_fyTieysOFgv2gljQI2iunJEc0CRijOlOTOXiNesbNX2-GZyRRFVRXFe/exec",{method:"GET",redirect:"follow",signal:n.signal});return p(),await o.json()}const Q=[{兑换物品名称:"体力药水(小)",图片:"https://lh3.googleusercontent.com/d/1M_1Zvh24BKTtiz-PkHfPEcpX22wb-kyW=w1000?authuser=0",参数:"item_id=36&cost_type=25&store_id=1&cost=4800&amount=1",版本:"",_imageFields:"图片"}];function me(){const p=x([]),n=M({}),i=x([]);async function w(o){const{action:l,force:r,sheetId:v,sheetName:m="",deploymentId:D,client:_}=o;let b=null;const U=l[m].copy,P=U?U.split(","):[];let E=null;if(r){const g=await ve({sheetId:v,sheetName:m,deploymentId:D,client:JSON.stringify(_)});if(g.success){b=g.data,E=g.extraData;const h=[],k=Object.keys(Q[0]).filter(A=>!A.startsWith("_"));let F=b.length-1;for(const A of Q){const R={};for(const S of k)R[S]=A[S];const V=A._imageFields;if(F++,V)for(const S of V.split(","))E.imageFields.push(`${F}:${S}`);h.push(R)}b.push(...h),Object.assign(n,g.source),localStorage.setItem("exchange-data",JSON.stringify(g))}}else{const g=JSON.parse(localStorage.getItem("exchange-data")||"{}");b=g.data,E=g.extraData,Object.assign(n,g.source)}const T=E.imageFields||[];i.value=Object.keys(b[0]);const H={};for(const g of T)H[g]=1;for(let g=0;g<b.length;g++){const h=b[g];for(const k of i.value)h[k]={value:h[k]},H[`${g}:${k}`]?h[k].renderImage=!0:P.includes(k)&&(h[k].copy=!0)}p.value=b}return{list:p,fields:i,queryExchangeData:w,spreadsheetSource:n}}function he(){const p=M({});async function n(i){const w=new Date;if(!i){const l=localStorage.getItem("exchange-data-config");let r=l?JSON.parse(l):null;if(r&&+r.expiration>w.getTime()){Object.assign(p,r);return}}const o=await ye();Object.assign(p,o),p.expiration=w.setHours(24,0,0,0),localStorage.setItem("exchange-data-config",JSON.stringify(p)),p.force=!0}return{config:p,queryExchangeDataConfig:n}}const xe={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]},data1:{type:Object,default:()=>({})}},emits:["update:visible","close","refresh"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh",!0)},copy(p){p&&(navigator.clipboard.writeText(p),window.alert("复制成功"))}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]},key2Data1(){return Object.keys(this.data1)}}},be={class:"modal-content",style:{padding:"0 10px"}},we={class:"modal-header"},ke={key:0,class:"desc"},_e={key:1,class:"modal-body data-state"},Oe={key:2,class:"modal-body loading-state"},Ie={key:3,class:"modal-body error-state"},De={class:"error-text"},Se={key:4,class:"modal-body data-state"},Ce=["src"],Ee={key:1,class:"multi-line"},Te=["onClick"],Ae={style:{"margin-top":"10px"}},Ue={key:5,class:"modal-body empty-state"};function $e(p,n,i,w,o,l){return B((f(),u("div",{class:"modal-overlay",onClick:n[3]||(n[3]=de((...r)=>l.handleOverlayClick&&l.handleOverlayClick(...r),["self"]))},[s("div",be,[s("div",we,[s("h2",null,I(i.title),1),s("button",{class:"close-btn",onClick:n[0]||(n[0]=(...r)=>l.closeModal&&l.closeModal(...r))},"×")]),i.description.length?(f(),u("div",ke,[(f(!0),u($,null,N(i.description,(r,v)=>(f(),u("p",{key:v},I(v+1)+"、"+I(r),1))),128))])):K("",!0),l.key2Data1.length?(f(),u("div",_e,[(f(!0),u($,null,N(i.data1,(r,v)=>(f(),u("p",{key:v},I(v)+": "+I(r),1))),128))])):i.loading?(f(),u("div",Oe,n[4]||(n[4]=[s("div",{class:"loading"},null,-1),s("p",null,"加载数据中...",-1)]))):i.error?(f(),u("div",Ie,[s("p",De,"❌ "+I(i.error),1),s("button",{onClick:n[1]||(n[1]=(...r)=>l.refresh&&l.refresh(...r))},"重试")])):i.data&&i.data.length>0?(f(),u("div",Se,[s("table",null,[s("thead",null,[s("tr",null,[(f(!0),u($,null,N(l.tabHeaders,(r,v)=>(f(),u("th",{key:v},I(r||`列 ${v+1}`),1))),128))])]),s("tbody",null,[(f(!0),u($,null,N(i.data,(r,v)=>(f(),u("tr",{key:v},[(f(!0),u($,null,N(r,(m,D)=>(f(),u("td",{key:D},[m.renderImage?(f(),u("img",{key:0,src:m.value,referrerpolicy:"no-referrer"},null,8,Ce)):(f(),u("div",Ee,[s("span",null,I(m.value),1)])),m.copy?(f(),u("button",{key:2,class:"btn-copy",onClick:_=>l.copy(m.value)}," 复制 ",8,Te)):K("",!0)]))),128))]))),128))])]),s("div",Ae,[s("button",{onClick:n[2]||(n[2]=(...r)=>l.refresh&&l.refresh(...r))},"刷新数据")])])):(f(),u("div",Ue,n[5]||(n[5]=[s("p",null,"暂无数据",-1)])))])],512)),[[ce,i.visible]])}const Y=re(xe,[["render",$e],["__scopeId","data-v-b9af3779"]]),Ne={class:"container1"},je={style:{"margin-bottom":"5px"}},He={style:{"margin-bottom":"5px"}},Fe={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},Re={style:{"margin-bottom":"5px"}},Ve={key:0},qe={style:{display:"flex","align-items":"flex-start"}},Me=["disabled"],Pe={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},Xe=["innerHTML"],q="cost",j="amount",L="curl",ze="PowerShell",z="fetch",Ke={__name:"exchange-api-param-generator",setup(p){const n=x(""),i=x(!1),w=x(""),o=M({type:"",part1:null,part2:null,part3:null,extra:null}),l=x(""),r=x(""),v=x(!1),m=x(!1),D=x(""),_=x(!1),b=x(!1),C=x(!1),U=/[\-]+\w+\s+/,{config:P,queryExchangeDataConfig:E}=he(),{list:T,queryExchangeData:H,spreadsheetSource:g}=me(),h=M({message:""}),k=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],F=ue(()=>{if(g.spreadsheetUrl){const a=[...k];return a[0]+=`: ${g.spreadsheetUrl}`,a}return k});function A(){v.value=!0,T.value.length||S(!1)}function R(){return{userAgent:navigator.userAgent}}const V=R();async function S(a){T.value.length&&(T.value.length=0),m.value=!0;try{await E(a),await H({...P,client:V})}catch(e){console.log("拉取数据失败"),console.log(e),D.value="拉取数据失败, 请检查网络或联系管理员"}finally{m.value=!1}}function ee(a,e){let t="--data-raw",y=a.lastIndexOf(t);if(y===-1&&(t="--data-binary",y=a.lastIndexOf(t)),y===-1)return;y+=t.length,e.type=L,e.part1=a.slice(0,y);let d=a.slice(y);const c=d.match(U);c&&(e.part3=d.slice(c.index),d=d.slice(0,c.index)),d=d.trim().slice(1,-1),e.part2=d}function te(a,e){const t="-Body";let y=a.lastIndexOf(t);if(y===-1)return;y+=t.length,e.type=ze,e.part1=a.slice(0,y);let d=a.slice(y);const c=d.match(U);c&&(e.part3=d.slice(c.index),d=d.slice(0,c.index)),d=d.trim().slice(1,-1),e.part2=d}function ae(a,e){e.type=z;const t=a.match(/^fetch\((.*?)\);$/s);if(t){const d=t[1],c=d.indexOf(",");if(c!=-1){const O={url:d.slice(1,c-1),options:new Function(`return ${d.slice(c+1)}`)()};e.part1=O.url,e.part2=O.options.body,e.extra=O}}}function se(){let a=n.value;if(!a){window.alert("请输入抓包参数");return}if(a.startsWith(L)?ee(a,o):a.startsWith("Invoke-WebRequest")?te(a,o):a.startsWith(z)&&ae(a,o),!o.part1||!o.part2)return window.alert("解析失败, 参数格式是否正确?");const e=o.part2.split("&");e.sort();const t={};for(const y of e){let[d,c]=y.split("=");if(d===q)if(c=decodeURIComponent(c),c.startsWith("[")){c=JSON.parse(c.replace(/\+/g,""));for(const O of c)O.unit=O.value/t[j]}else t.costUnit=c/t[j];t[d]=c}if(!t[j]&&!t[q]){window.alert("请输入正确的抓包参数");return}o.part2Parsed=t,i.value=!0,w.value=t[j]}function ne(){let a=r.value;if(!a){window.alert("请输入兑换数量");return}if(a=a>>0,a<1){window.alert("请输入正确的兑换数量");return}let e="";const t={...o.part2Parsed};t[j]=a;let y;const d=t[q];Array.isArray(d)||(y=t.costUnit,delete t.costUnit);for(const c in t)if(c===q)if(y)e+=`${c}=${y*a}&`;else{const O=[];for(const J of d){const X={...J};X.value=""+J.unit*a,delete X.unit,O.push(X)}e+=`${c}=${encodeURIComponent(JSON.stringify(O))}&`}else e+=`${c}=${t[c]}&`;e=e.slice(0,-1),o.type===z?(l.value=`fetch('${o.part1}', ${JSON.stringify({...o.extra.options,body:e})});`,o.extra._params=e,_.value=!0):(l.value=`${o.part1} '${e}'`,o.part3&&(l.value+=` ${o.part3}`))}function ie(){l.value&&(navigator.clipboard.writeText(l.value),window.alert("复制成功"))}async function oe(){if(!_.value||C.value)return;C.value=!0,setTimeout(()=>{C.value=!1},5e3);const a=await fetch(o.extra.url,{...o.extra.options,body:o.extra._params});h.status_code=a.status;try{const e=await a.json();Object.assign(h,e)}catch(e){console.log(e);try{const t=await a.text();h.respText=t}catch(t){console.log(t)}h.message="请求失败, 网络或参数错误"}finally{b.value=!0}}function le(){l.value&&(l.value=""),i.value&&(i.value=!1),n.value&&(n.value=""),_.value&&(_.value=!1)}return(a,e)=>(f(),u("div",Ne,[e[6]||(e[6]=s("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),e[7]||(e[7]=s("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),e[8]||(e[8]=s("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),s("div",je,[s("div",He,[e[4]||(e[4]=s("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),s("div",Fe,[B(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),placeholder:"请输入",id:"command",style:{width:"500px","margin-right":"10px"},rows:"6"},null,512),[[W,n.value]])]),s("div",Re,[s("button",{onClick:A,style:{"margin-right":"10px"}},"浏览参数"),s("button",{onClick:se,style:{"margin-right":"10px"}},"解析"),i.value?(f(),u("span",Ve," 成功, 当前兑换数量为: "+I(w.value),1)):K("",!0)])]),s("div",null,[e[5]||(e[5]=s("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),s("div",qe,[B(s("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":e[1]||(e[1]=t=>r.value=t)},null,512),[[W,r.value,void 0,{number:!0}]]),s("button",{onClick:ne,style:{"margin-right":"10px",cursor:"pointer"}},"生成"),s("button",{onClick:ie,style:{"margin-right":"10px",cursor:"pointer"}},"复制"),s("button",{onClick:le,style:{"margin-right":"10px",cursor:"pointer"}},"清除"),s("button",{disabled:!_.value||C.value,onClick:oe,style:pe({cursor:_.value&&!C.value?"pointer":"not-allowed"})},"执行",12,Me)])]),s("div",Pe,[s("div",{innerHTML:l.value},null,8,Xe)])]),e[9]||(e[9]=fe('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...,</div><div style="font-size:13px;">若是fetch, 则以fetch开头, 并且可直接在当前网页上执行</div>',6)),G(Y,{visible:v.value,"onUpdate:visible":e[2]||(e[2]=t=>v.value=t),title:"兑换参数对照表",data:ge(T),description:F.value,onRefresh:S,loading:m.value,error:D.value},null,8,["visible","data","description","loading","error"]),G(Y,{visible:b.value,"onUpdate:visible":e[3]||(e[3]=t=>b.value=t),title:"执行fetch命令",data1:h},null,8,["visible","data1"])]))}};export{Ke as default};
