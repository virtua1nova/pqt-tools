import{r as h,a as D,_ as G,w as C,v as F,c as v,b as e,d as E,t as b,F as k,e as O,f as K,o as g,g as J,h as Q,i as W,j as L,k as $,u as Y}from"./index-BPy3eBcu.js";async function Z(p){const{sheetId:n,sheetName:l=""}=p;let u=`https://script.google.com/macros/s/AKfycbzf3AIetwEitGy5t1ORgW2JW5HgMzOHw-kZRM_cQrFny3fGFL9_PcRI3re3T52BghBF/exec?sheetId=${n}&sheetName=${l}`;return await(await fetch(u,{method:"GET",redirect:"follow"})).json()}async function tt(){return await(await fetch("https://script.google.com/macros/s/AKfycbyRrP5xSt3A_fyTieysOFgv2gljQI2iunJEc0CRijOlOTOXiNesbNX2-GZyRRFVRXFe/exec",{method:"GET",redirect:"follow"})).json()}function et(){const p=h([]),n=D({}),l=h([]);async function y(u){let i=null;if(u.force){const a=await Z(u);a.success&&(i=a.data,Object.assign(n,a.source),localStorage.setItem("exchange-data",JSON.stringify(a)))}else{const a=JSON.parse(localStorage.getItem("exchange-data")||"{}");i=a.data,Object.assign(n,a.source)}l.value=Object.keys(i[0]);for(const a of i)for(const d of l.value)a[d]={value:a[d]},d=="图片"?a[d].value.startsWith("http")&&(a[d].renderImage=!0):d=="参数"&&(a[d].copy=!0);p.value=i}return{list:p,fields:l,queryExchangeDataList:y,spreadsheetSource:n}}function at(){const p=D({});async function n({force:l}={}){const y=new Date;if(!l){const i=localStorage.getItem("exchange-data-config");let a=i?JSON.parse(i):null;if(a&&+a.expiration>y.getTime()){Object.assign(p,a);return}}const u=await tt();Object.assign(p,u),p.expiration=y.setHours(24,0,0,0),p.force=!0,localStorage.setItem("exchange-data-config",JSON.stringify(p))}return{config:p,queryExchangeDataConfig:n}}const it={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]}},emits:["update:visible","close","refresh"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh")},copy(p){p&&(navigator.clipboard.writeText(p),window.alert("复制成功"))}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]}}},st={class:"modal-content",style:{padding:"0 10px"}},nt={class:"modal-header"},ot={class:"desc"},lt={key:0,class:"modal-body loading-state"},rt={key:1,class:"modal-body data-state"},dt=["src"],ct={key:1,class:"multi-line"},ut=["onClick"],pt={style:{"margin-top":"10px"}},ft={key:2,class:"modal-body empty-state"};function vt(p,n,l,y,u,i){return C((g(),v("div",{class:"modal-overlay",onClick:n[2]||(n[2]=K((...a)=>i.handleOverlayClick&&i.handleOverlayClick(...a),["self"]))},[e("div",st,[e("div",nt,[e("h2",null,b(l.title),1),e("button",{class:"close-btn",onClick:n[0]||(n[0]=(...a)=>i.closeModal&&i.closeModal(...a))},"×")]),e("div",ot,[(g(!0),v(k,null,O(l.description,(a,d)=>(g(),v("p",{key:d},b(d+1)+"、"+b(a),1))),128))]),l.loading?(g(),v("div",lt,n[3]||(n[3]=[e("div",{class:"loading"},null,-1),e("p",null,"加载数据中...",-1)]))):E("",!0),l.data&&l.data.length>0?(g(),v("div",rt,[e("table",null,[e("thead",null,[e("tr",null,[(g(!0),v(k,null,O(i.tabHeaders,(a,d)=>(g(),v("th",{key:d},b(a||`列 ${d+1}`),1))),128))])]),e("tbody",null,[(g(!0),v(k,null,O(l.data,(a,d)=>(g(),v("tr",{key:d},[(g(!0),v(k,null,O(a,(m,w)=>(g(),v("td",{key:w},[m.renderImage?(g(),v("img",{key:0,src:m.value,referrerpolicy:"no-referrer"},null,8,dt)):(g(),v("div",ct,[e("span",null,b(m.value),1)])),m.copy?(g(),v("button",{key:2,class:"btn-copy",onClick:I=>i.copy(m.value)}," 复制 ",8,ut)):E("",!0)]))),128))]))),128))])]),e("div",pt,[e("button",{onClick:n[1]||(n[1]=(...a)=>i.refresh&&i.refresh(...a))},"刷新数据")])])):(g(),v("div",ft,n[4]||(n[4]=[e("p",null,"暂无数据",-1)])))])],512)),[[F,l.visible]])}const gt=G(it,[["render",vt],["__scopeId","data-v-4c9b8e42"]]),yt={class:"container1"},mt={style:{"margin-bottom":"5px"}},ht={style:{"margin-bottom":"5px"}},xt={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},bt={style:{"margin-bottom":"5px"}},wt={key:0},kt={style:{display:"flex","align-items":"flex-start"}},Ot={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},_t=["innerHTML"],S="cost",_="amount",N="curl",It="PowerShell",Ct={__name:"exchange-api-param-generator",setup(p){const n=h(""),l=h(!1),y=h(""),u=D({type:"",part1:null,part2:null,part3:null}),i=h(""),a=h(""),d=h(!1),m=h(!1),w=/[\-]+\w+\s+/,{config:I,queryExchangeDataConfig:A}=at(),{list:T,queryExchangeDataList:H,spreadsheetSource:U}=et(),R=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],M=J(()=>{if(U.spreadsheetUrl){const o=[...R];return o[0]+=`: ${U.spreadsheetUrl}`,o}return R});Q(async()=>{await A(),H(I)});async function V(){T.value.length=0,m.value=!0,await A({force:!0}),await H(I),m.value=!1}function j(o,t){let s="--data-raw",c=o.lastIndexOf(s);if(c===-1&&(s="--data-binary",c=o.lastIndexOf(s)),c===-1)return;c+=s.length,t.type=N,t.part1=o.slice(0,c);let r=o.slice(c);const f=r.match(w);f&&(t.part3=r.slice(f.index),r=r.slice(0,f.index)),r=r.trim().slice(1,-1),t.part2=r}function q(o,t){const s="-Body";let c=o.lastIndexOf(s);if(c===-1)return;c+=s.length,t.type=It,t.part1=o.slice(0,c);let r=o.slice(c);const f=r.match(w);f&&(t.part3=r.slice(f.index),r=r.slice(0,f.index)),r=r.trim().slice(1,-1),t.part2=r}function B(){let o=n.value;if(!o){window.alert("请输入抓包参数");return}if(o.startsWith(N)?j(o,u):o.startsWith("Invoke-WebRequest")&&q(o,u),!u.part1||!u.part2)return window.alert("解析失败, 参数格式是否正确?");const t=u.part2.split("&");t.sort();const s={};for(const c of t){let[r,f]=c.split("=");if(r===S){f=decodeURIComponent(f),f=JSON.parse(f.replace(/\+/g,""));for(const x of f)x.unit=x.value/s[_]}s[r]=f}if(!s[_]&&!s[S]){window.alert("请输入正确的抓包参数");return}u.part2Parsed=s,l.value=!0,y.value=s[_]}function P(){let o=a.value;if(!o){window.alert("请输入兑换数量");return}if(o=o>>0,o<1){window.alert("请输入正确的兑换数量");return}let t="";const s={...u.part2Parsed};s[_]=o;for(const c in s)if(c===S){const r=[];for(const f of s[c]){const x={...f};x.value=""+f.unit*o,delete x.unit,r.push(x)}t+=`${c}=${encodeURIComponent(JSON.stringify(r))}&`}else t+=`${c}=${s[c]}&`;i.value=`${u.part1} '${t.slice(0,-1)}'`,u.part3&&(i.value+=` ${u.part3}`)}function X(){i.value&&(navigator.clipboard.writeText(i.value),window.alert("复制成功"))}function z(){i.value&&(i.value=""),l.value&&(l.value=!1),n.value&&(n.value="")}return(o,t)=>(g(),v("div",yt,[t[6]||(t[6]=e("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),t[7]||(t[7]=e("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),t[8]||(t[8]=e("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),e("div",mt,[e("div",ht,[t[4]||(t[4]=e("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),e("div",xt,[C(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),placeholder:"请输入",id:"command",style:{width:"360px","margin-right":"10px"},rows:"4"},null,512),[[$,n.value]])]),e("div",bt,[e("button",{onClick:t[1]||(t[1]=s=>d.value=!0),style:{"margin-right":"10px"}},"浏览参数"),e("button",{onClick:B,style:{"margin-right":"10px"}},"解析"),l.value?(g(),v("span",wt," 成功, 当前兑换数量为: "+b(y.value),1)):E("",!0)])]),e("div",null,[t[5]||(t[5]=e("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),e("div",kt,[C(e("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":t[2]||(t[2]=s=>a.value=s)},null,512),[[$,a.value,void 0,{number:!0}]]),e("button",{onClick:P,style:{"margin-right":"10px"}},"生成"),e("button",{onClick:X,style:{"margin-right":"10px"}},"复制"),e("button",{onClick:z},"清除")])]),e("div",Ot,[e("div",{innerHTML:i.value},null,8,_t)])]),t[9]||(t[9]=W('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...</div>',5)),L(gt,{visible:d.value,"onUpdate:visible":t[3]||(t[3]=s=>d.value=s),title:"兑换参数对照表",data:Y(T),description:M.value,onRefresh:V,loading:m.value},null,8,["visible","data","description","loading"])]))}};export{Ct as default};
