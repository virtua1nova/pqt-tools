import{r as x,a as q,_ as Q,w as R,v as W,c as p,b as t,t as O,F as T,d as N,e as L,o as g,f as X,g as Y,h as Z,i as ee,j as te,k as j,u as ne}from"./index-BL5QJo-F.js";async function ae(c){const{sheetId:n,sheetName:o="",deploymentId:h,client:d}=c,{cancel:s,controller:l}=F(1e4);let y=`${`https://script.google.com/macros/s/${h}/exec`}?sheetId=${n}&sheetName=${o}&client=${d}`;const w=await fetch(y,{method:"GET",redirect:"follow",signal:l.signal});return s(),await w.json()}function F(c){const n=new AbortController,o=setTimeout(()=>{n.abort()},c);return{controller:n,cancel:()=>{clearTimeout(o)}}}async function ie(){const{cancel:c,controller:n}=F(1e4),d=await fetch("https://script.google.com/macros/s/AKfycbyRrP5xSt3A_fyTieysOFgv2gljQI2iunJEc0CRijOlOTOXiNesbNX2-GZyRRFVRXFe/exec",{method:"GET",redirect:"follow",signal:n.signal});return c(),await d.json()}function oe(){const c=x([]),n=q({}),o=x([]);async function h(d){const{action:s,force:l,sheetId:m,sheetName:y="",deploymentId:w,client:E}=d;let k=null;const _=s[y].copy,$=_?_.split(","):[];let I=null;if(l){const f=await ae({sheetId:m,sheetName:y,deploymentId:w,client:JSON.stringify(E)});f.success&&(k=f.data,I=f.extraData,Object.assign(n,f.source),localStorage.setItem("exchange-data",JSON.stringify(f)))}else{const f=JSON.parse(localStorage.getItem("exchange-data")||"{}");k=f.data,I=f.extraData,Object.assign(n,f.source)}const D=I.imageFields||[];o.value=Object.keys(k[0]);const A={};for(const f of D)A[f]=1;for(let f=0;f<k.length;f++){const C=k[f];for(const b of o.value)C[b]={value:C[b]},A[`${f}:${b}`]?C[b].renderImage=!0:$.includes(b)&&(C[b].copy=!0)}c.value=k}return{list:c,fields:o,queryExchangeData:h,spreadsheetSource:n}}function se(){const c=q({});async function n(o){const h=new Date;if(!o){const s=localStorage.getItem("exchange-data-config");let l=s?JSON.parse(s):null;if(l&&+l.expiration>h.getTime()){Object.assign(c,l);return}}const d=await ie();Object.assign(c,d),c.expiration=h.setHours(24,0,0,0),c.force=!0,localStorage.setItem("exchange-data-config",JSON.stringify(c))}return{config:c,queryExchangeDataConfig:n}}const le={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]}},emits:["update:visible","close","refresh"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh",!0)},copy(c){c&&(navigator.clipboard.writeText(c),window.alert("复制成功"))}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]}}},re={class:"modal-content",style:{padding:"0 10px"}},ce={class:"modal-header"},de={class:"desc"},ue={key:0,class:"modal-body loading-state"},fe={key:1,class:"modal-body error-state"},pe={class:"error-text"},ge={key:2,class:"modal-body data-state"},ve=["src"],me={key:1,class:"multi-line"},ye=["onClick"],he={style:{"margin-top":"10px"}},xe={key:3,class:"modal-body empty-state"};function be(c,n,o,h,d,s){return R((g(),p("div",{class:"modal-overlay",onClick:n[3]||(n[3]=L((...l)=>s.handleOverlayClick&&s.handleOverlayClick(...l),["self"]))},[t("div",re,[t("div",ce,[t("h2",null,O(o.title),1),t("button",{class:"close-btn",onClick:n[0]||(n[0]=(...l)=>s.closeModal&&s.closeModal(...l))},"×")]),t("div",de,[(g(!0),p(T,null,N(o.description,(l,m)=>(g(),p("p",{key:m},O(m+1)+"、"+O(l),1))),128))]),o.loading?(g(),p("div",ue,n[4]||(n[4]=[t("div",{class:"loading"},null,-1),t("p",null,"加载数据中...",-1)]))):o.error?(g(),p("div",fe,[t("p",pe,"❌ "+O(o.error),1),t("button",{onClick:n[1]||(n[1]=(...l)=>s.refresh&&s.refresh(...l))},"重试")])):o.data&&o.data.length>0?(g(),p("div",ge,[t("table",null,[t("thead",null,[t("tr",null,[(g(!0),p(T,null,N(s.tabHeaders,(l,m)=>(g(),p("th",{key:m},O(l||`列 ${m+1}`),1))),128))])]),t("tbody",null,[(g(!0),p(T,null,N(o.data,(l,m)=>(g(),p("tr",{key:m},[(g(!0),p(T,null,N(l,(y,w)=>(g(),p("td",{key:w},[y.renderImage?(g(),p("img",{key:0,src:y.value,referrerpolicy:"no-referrer"},null,8,ve)):(g(),p("div",me,[t("span",null,O(y.value),1)])),y.copy?(g(),p("button",{key:2,class:"btn-copy",onClick:E=>s.copy(y.value)}," 复制 ",8,ye)):X("",!0)]))),128))]))),128))])]),t("div",he,[t("button",{onClick:n[2]||(n[2]=(...l)=>s.refresh&&s.refresh(...l))},"刷新数据")])])):(g(),p("div",xe,n[5]||(n[5]=[t("p",null,"暂无数据",-1)])))])],512)),[[W,o.visible]])}const we=Q(le,[["render",be],["__scopeId","data-v-08b0f629"]]),ke={class:"container1"},Oe={style:{"margin-bottom":"5px"}},_e={style:{"margin-bottom":"5px"}},Ie={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},Ce={style:{"margin-bottom":"5px"}},Se={key:0},Ee={style:{display:"flex","align-items":"flex-start"}},De={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},Ae=["innerHTML"],H="cost",U="amount",M="curl",Te="PowerShell",Ue={__name:"exchange-api-param-generator",setup(c){const n=x(""),o=x(!1),h=x(""),d=q({type:"",part1:null,part2:null,part3:null}),s=x(""),l=x(""),m=x(!1),y=x(!1),w=x(""),E=/[\-]+\w+\s+/,{config:k,queryExchangeDataConfig:V}=se(),{list:_,queryExchangeData:$,spreadsheetSource:I}=oe(),D=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],A=Y(()=>{if(I.spreadsheetUrl){const a=[...D];return a[0]+=`: ${I.spreadsheetUrl}`,a}return D});Z(()=>{b(!1)});function f(){return{userAgent:navigator.userAgent}}const C=f();async function b(a){_.value.length&&(_.value.length=0),y.value=!0;try{await V(a),await $({...k,client:C})}catch(e){console.log("拉取数据失败"),console.log(e),w.value="拉取数据失败, 请检查网络或联系管理员"}finally{y.value=!1}}function P(a,e){let i="--data-raw",u=a.lastIndexOf(i);if(u===-1&&(i="--data-binary",u=a.lastIndexOf(i)),u===-1)return;u+=i.length,e.type=M,e.part1=a.slice(0,u);let r=a.slice(u);const v=r.match(E);v&&(e.part3=r.slice(v.index),r=r.slice(0,v.index)),r=r.trim().slice(1,-1),e.part2=r}function B(a,e){const i="-Body";let u=a.lastIndexOf(i);if(u===-1)return;u+=i.length,e.type=Te,e.part1=a.slice(0,u);let r=a.slice(u);const v=r.match(E);v&&(e.part3=r.slice(v.index),r=r.slice(0,v.index)),r=r.trim().slice(1,-1),e.part2=r}function z(){let a=n.value;if(!a){window.alert("请输入抓包参数");return}if(a.startsWith(M)?P(a,d):a.startsWith("Invoke-WebRequest")&&B(a,d),!d.part1||!d.part2)return window.alert("解析失败, 参数格式是否正确?");const e=d.part2.split("&");e.sort();const i={};for(const u of e){let[r,v]=u.split("=");if(r===H){v=decodeURIComponent(v),v=JSON.parse(v.replace(/\+/g,""));for(const S of v)S.unit=S.value/i[U]}i[r]=v}if(!i[U]&&!i[H]){window.alert("请输入正确的抓包参数");return}d.part2Parsed=i,o.value=!0,h.value=i[U]}function G(){let a=l.value;if(!a){window.alert("请输入兑换数量");return}if(a=a>>0,a<1){window.alert("请输入正确的兑换数量");return}let e="";const i={...d.part2Parsed};i[U]=a;for(const u in i)if(u===H){const r=[];for(const v of i[u]){const S={...v};S.value=""+v.unit*a,delete S.unit,r.push(S)}e+=`${u}=${encodeURIComponent(JSON.stringify(r))}&`}else e+=`${u}=${i[u]}&`;s.value=`${d.part1} '${e.slice(0,-1)}'`,d.part3&&(s.value+=` ${d.part3}`)}function J(){s.value&&(navigator.clipboard.writeText(s.value),window.alert("复制成功"))}function K(){s.value&&(s.value=""),o.value&&(o.value=!1),n.value&&(n.value="")}return(a,e)=>(g(),p("div",ke,[e[6]||(e[6]=t("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),e[7]||(e[7]=t("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),e[8]||(e[8]=t("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),t("div",Oe,[t("div",_e,[e[4]||(e[4]=t("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),t("div",Ie,[R(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=i=>n.value=i),placeholder:"请输入",id:"command",style:{width:"360px","margin-right":"10px"},rows:"4"},null,512),[[j,n.value]])]),t("div",Ce,[t("button",{onClick:e[1]||(e[1]=i=>m.value=!0),style:{"margin-right":"10px"}},"浏览参数"),t("button",{onClick:z,style:{"margin-right":"10px"}},"解析"),o.value?(g(),p("span",Se," 成功, 当前兑换数量为: "+O(h.value),1)):X("",!0)])]),t("div",null,[e[5]||(e[5]=t("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),t("div",Ee,[R(t("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":e[2]||(e[2]=i=>l.value=i)},null,512),[[j,l.value,void 0,{number:!0}]]),t("button",{onClick:G,style:{"margin-right":"10px"}},"生成"),t("button",{onClick:J,style:{"margin-right":"10px"}},"复制"),t("button",{onClick:K},"清除")])]),t("div",De,[t("div",{innerHTML:s.value},null,8,Ae)])]),e[9]||(e[9]=ee('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...</div>',5)),te(we,{visible:m.value,"onUpdate:visible":e[3]||(e[3]=i=>m.value=i),title:"兑换参数对照表",data:ne(_),description:A.value,onRefresh:b,loading:y.value,error:w.value},null,8,["visible","data","description","loading","error"])]))}};export{Ue as default};
