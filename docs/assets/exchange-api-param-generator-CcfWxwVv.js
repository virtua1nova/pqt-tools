import{r as b,a as R,_ as G,w as $,v as K,c as u,b as t,t as O,F as N,d as T,e as J,o as p,f as M,g as Q,h as L,i as W,j as Y,k as j,u as Z}from"./index-CE4hXRYX.js";async function ee(f){const{sheetId:a,sheetName:l="",deploymentId:h}=f;let n=`${`https://script.google.com/macros/s/${h}/exec`}?sheetId=${a}&sheetName=${l}`;return await(await fetch(n,{method:"GET",redirect:"follow"})).json()}async function te(){return await(await fetch("https://script.google.com/macros/s/AKfycbyRrP5xSt3A_fyTieysOFgv2gljQI2iunJEc0CRijOlOTOXiNesbNX2-GZyRRFVRXFe/exec",{method:"GET",redirect:"follow"})).json()}function ae(){const f=b([]),a=R({}),l=b([]);async function h(g){const{action:n,force:o,sheetId:y,sheetName:m="",deploymentId:_}=g;let x=null;const D=n[m].copy,S=D?D.split(","):[];let C=null;if(o){const c=await ee({sheetId:y,sheetName:m,deploymentId:_});c.success&&(x=c.data,C=c.extraData,Object.assign(a,c.source),localStorage.setItem("exchange-data",JSON.stringify(c)))}else{const c=JSON.parse(localStorage.getItem("exchange-data")||"{}");x=c.data,C=c.extraData,Object.assign(a,c.source)}const A=C.imageFields||[];l.value=Object.keys(x[0]);const E={};for(const c of A)E[c]=1;for(let c=0;c<x.length;c++){const k=x[c];for(const w of l.value)k[w]={value:k[w]},E[`${c}:${w}`]?k[w].renderImage=!0:S.includes(w)&&(k[w].copy=!0)}f.value=x}return{list:f,fields:l,queryExchangeDataList:h,spreadsheetSource:a}}function ie(){const f=R({});async function a(l){const h=new Date;if(!l){const n=localStorage.getItem("exchange-data-config");let o=n?JSON.parse(n):null;if(o&&+o.expiration>h.getTime()){Object.assign(f,o);return}}const g=await te();Object.assign(f,g),f.expiration=h.setHours(24,0,0,0),f.force=!0,localStorage.setItem("exchange-data-config",JSON.stringify(f))}return{config:f,queryExchangeDataConfig:a}}const se={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]}},emits:["update:visible","close","refresh"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh",!0)},copy(f){f&&(navigator.clipboard.writeText(f),window.alert("复制成功"))}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]}}},ne={class:"modal-content",style:{padding:"0 10px"}},oe={class:"modal-header"},le={class:"desc"},re={key:0,class:"modal-body loading-state"},de={key:1,class:"modal-body error-state"},ce={class:"error-text"},ue={key:2,class:"modal-body data-state"},pe=["src"],fe={key:1,class:"multi-line"},ve=["onClick"],ge={style:{"margin-top":"10px"}},ye={key:3,class:"modal-body empty-state"};function me(f,a,l,h,g,n){return $((p(),u("div",{class:"modal-overlay",onClick:a[3]||(a[3]=J((...o)=>n.handleOverlayClick&&n.handleOverlayClick(...o),["self"]))},[t("div",ne,[t("div",oe,[t("h2",null,O(l.title),1),t("button",{class:"close-btn",onClick:a[0]||(a[0]=(...o)=>n.closeModal&&n.closeModal(...o))},"×")]),t("div",le,[(p(!0),u(N,null,T(l.description,(o,y)=>(p(),u("p",{key:y},O(y+1)+"、"+O(o),1))),128))]),l.loading?(p(),u("div",re,a[4]||(a[4]=[t("div",{class:"loading"},null,-1),t("p",null,"加载数据中...",-1)]))):l.error?(p(),u("div",de,[t("p",ce,"❌ "+O(l.error),1),t("button",{onClick:a[1]||(a[1]=(...o)=>n.refresh&&n.refresh(...o))},"重试")])):l.data&&l.data.length>0?(p(),u("div",ue,[t("table",null,[t("thead",null,[t("tr",null,[(p(!0),u(N,null,T(n.tabHeaders,(o,y)=>(p(),u("th",{key:y},O(o||`列 ${y+1}`),1))),128))])]),t("tbody",null,[(p(!0),u(N,null,T(l.data,(o,y)=>(p(),u("tr",{key:y},[(p(!0),u(N,null,T(o,(m,_)=>(p(),u("td",{key:_},[m.renderImage?(p(),u("img",{key:0,src:m.value,referrerpolicy:"no-referrer"},null,8,pe)):(p(),u("div",fe,[t("span",null,O(m.value),1)])),m.copy?(p(),u("button",{key:2,class:"btn-copy",onClick:x=>n.copy(m.value)}," 复制 ",8,ve)):M("",!0)]))),128))]))),128))])]),t("div",ge,[t("button",{onClick:a[2]||(a[2]=(...o)=>n.refresh&&n.refresh(...o))},"刷新数据")])])):(p(),u("div",ye,a[5]||(a[5]=[t("p",null,"暂无数据",-1)])))])],512)),[[K,l.visible]])}const he=G(se,[["render",me],["__scopeId","data-v-08b0f629"]]),xe={class:"container1"},be={style:{"margin-bottom":"5px"}},we={style:{"margin-bottom":"5px"}},ke={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},Oe={style:{"margin-bottom":"5px"}},_e={key:0},Ie={style:{display:"flex","align-items":"flex-start"}},Se={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},Ce=["innerHTML"],H="cost",U="amount",q="curl",Ee="PowerShell",Ae={__name:"exchange-api-param-generator",setup(f){const a=b(""),l=b(!1),h=b(""),g=R({type:"",part1:null,part2:null,part3:null}),n=b(""),o=b(""),y=b(!1),m=b(!1),_=b(""),x=/[\-]+\w+\s+/,{config:V,queryExchangeDataConfig:D}=ie(),{list:S,queryExchangeDataList:C,spreadsheetSource:A}=ae(),E=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],c=Q(()=>{if(A.spreadsheetUrl){const i=[...E];return i[0]+=`: ${A.spreadsheetUrl}`,i}return E});L(()=>{k(!1)});async function k(i){S.value.length&&(S.value.length=0),m.value=!0;try{await D(i),await C(V)}catch(e){console.log("加载失败"),console.log(e),_.value="拉取数据失败, 请检查网络或联系管理员"}finally{m.value=!1}}function w(i,e){let s="--data-raw",d=i.lastIndexOf(s);if(d===-1&&(s="--data-binary",d=i.lastIndexOf(s)),d===-1)return;d+=s.length,e.type=q,e.part1=i.slice(0,d);let r=i.slice(d);const v=r.match(x);v&&(e.part3=r.slice(v.index),r=r.slice(0,v.index)),r=r.trim().slice(1,-1),e.part2=r}function X(i,e){const s="-Body";let d=i.lastIndexOf(s);if(d===-1)return;d+=s.length,e.type=Ee,e.part1=i.slice(0,d);let r=i.slice(d);const v=r.match(x);v&&(e.part3=r.slice(v.index),r=r.slice(0,v.index)),r=r.trim().slice(1,-1),e.part2=r}function F(){let i=a.value;if(!i){window.alert("请输入抓包参数");return}if(i.startsWith(q)?w(i,g):i.startsWith("Invoke-WebRequest")&&X(i,g),!g.part1||!g.part2)return window.alert("解析失败, 参数格式是否正确?");const e=g.part2.split("&");e.sort();const s={};for(const d of e){let[r,v]=d.split("=");if(r===H){v=decodeURIComponent(v),v=JSON.parse(v.replace(/\+/g,""));for(const I of v)I.unit=I.value/s[U]}s[r]=v}if(!s[U]&&!s[H]){window.alert("请输入正确的抓包参数");return}g.part2Parsed=s,l.value=!0,h.value=s[U]}function P(){let i=o.value;if(!i){window.alert("请输入兑换数量");return}if(i=i>>0,i<1){window.alert("请输入正确的兑换数量");return}let e="";const s={...g.part2Parsed};s[U]=i;for(const d in s)if(d===H){const r=[];for(const v of s[d]){const I={...v};I.value=""+v.unit*i,delete I.unit,r.push(I)}e+=`${d}=${encodeURIComponent(JSON.stringify(r))}&`}else e+=`${d}=${s[d]}&`;n.value=`${g.part1} '${e.slice(0,-1)}'`,g.part3&&(n.value+=` ${g.part3}`)}function B(){n.value&&(navigator.clipboard.writeText(n.value),window.alert("复制成功"))}function z(){n.value&&(n.value=""),l.value&&(l.value=!1),a.value&&(a.value="")}return(i,e)=>(p(),u("div",xe,[e[6]||(e[6]=t("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),e[7]||(e[7]=t("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),e[8]||(e[8]=t("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),t("div",be,[t("div",we,[e[4]||(e[4]=t("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),t("div",ke,[$(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.value=s),placeholder:"请输入",id:"command",style:{width:"360px","margin-right":"10px"},rows:"4"},null,512),[[j,a.value]])]),t("div",Oe,[t("button",{onClick:e[1]||(e[1]=s=>y.value=!0),style:{"margin-right":"10px"}},"浏览参数"),t("button",{onClick:F,style:{"margin-right":"10px"}},"解析"),l.value?(p(),u("span",_e," 成功, 当前兑换数量为: "+O(h.value),1)):M("",!0)])]),t("div",null,[e[5]||(e[5]=t("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),t("div",Ie,[$(t("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":e[2]||(e[2]=s=>o.value=s)},null,512),[[j,o.value,void 0,{number:!0}]]),t("button",{onClick:P,style:{"margin-right":"10px"}},"生成"),t("button",{onClick:B,style:{"margin-right":"10px"}},"复制"),t("button",{onClick:z},"清除")])]),t("div",Se,[t("div",{innerHTML:n.value},null,8,Ce)])]),e[9]||(e[9]=W('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...</div>',5)),Y(he,{visible:y.value,"onUpdate:visible":e[3]||(e[3]=s=>y.value=s),title:"兑换参数对照表",data:Z(S),description:c.value,onRefresh:k,loading:m.value,error:_.value},null,8,["visible","data","description","loading","error"])]))}};export{Ae as default};
