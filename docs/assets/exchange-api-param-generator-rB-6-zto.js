import{r as _,a as N,_ as dt,w as V,v as ut,c as f,b as a,d as M,t as T,F as q,e as G,f as gt,o as p,g as ft,h as pt,i as B,j as F,n as vt,u as mt}from"./index-NDGjmmx-.js";async function yt(v){const{sheetId:s,sheetName:c=""}=v,{cancel:I,controller:l}=Y(15e3),i=`https://docs.google.com/spreadsheets/d/${s}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(c)}`,r=await fetch(i,{method:"GET",redirect:"follow",signal:l.signal});I();const m=(await r.text()).replace(/\"/g,"").split(`
`).map(b=>b.split(",")),y=m[0].filter(b=>b),w=[];for(let b=1;b<m.length;b++){const S={},H=m[b];for(let D=0;D<y.length;D++){const A=H[D];S[y[D]]=A}w.push(S)}return{success:!0,source:{sheetName:c,spreadsheetUrl:`https://docs.google.com/spreadsheets/d/${s}/edit`},data:w,extraData:{imageFields:[]}}}function Y(v){const s=new AbortController,c=setTimeout(()=>{s.abort()},v);return{controller:s,cancel:()=>{clearTimeout(c)}}}async function ht(v){const{client:s=""}=v,{cancel:c,controller:I}=Y(15e3);let i=`${`https://script.google.com/macros/s/AKfycbwNSL2bAGjo2BW0kSy7f-PO7yDL6xf5TgemhTtUPpljMRL0ub22afYLWmLgEPDyrBQMAQ/exec?client=${s}`}`;const r=await fetch(i,{method:"GET",redirect:"follow",signal:I.signal});return c(),await r.json()}const K=[{兑换物品名称:"体力药水(小)",图片:"https://lh3.googleusercontent.com/d/1M_1Zvh24BKTtiz-PkHfPEcpX22wb-kyW=w1000?authuser=0",参数:"item_id=36&cost_type=25&cost=4800&amount=1",备注:"需要将原始抓包数据的store_id与网站提供的参数拼接, 且需要在金币商店中刷出药水的时候才可使用。",版本:"",_imageFields:"图片"},{兑换物品名称:"体力药水(中)",图片:"https://lh3.googleusercontent.com/rd-d/ALs6j_GsgQnuYAfGd63MBHIqYtczmSfQFb37-ZNmHzq4WoYJVFdbmDuIyNfvmtKq-bHIkQYMdMGJln-VmNdPWoR5Qj9la5327jQ--Vxks2yD7RPx5XQCZpyXSWwcZ6gude58bPXyminyvb1EHIbFUh5TrGTDTh0w-mCv3Jlgg6muT_injSk3j1ATTMvsMzXeGuqc5V2tL3OqEW9edOYpbG32rbp8eLg-SV3IdVKjGS92SALGdzVZN2s9-7DrWil4u-XrJCI92hLrwEpdcZWas_YZtnCDi-bJRAsAogCoXdw9FrJAsFyZlSiRXOVpSlJTfKvBZ1v_R_n4e5GUc9LbBcyoQhRWcz4c5LpbmaKZIRObcogDsURculRrkkfVU5EJWo7wJKC12jtzHQdOlY31xvPNgWt3pg64z99jJzIdUMWiPhMDusBrPdqQzBCaDgGZyA5zCtH7IWhnnutgw6-mCdCb7qQ_3rDvuL7iC28g04T0EbT_0kCA_V1MLCFwQ4PrO4wFL4nlxwFvUN1ImLW9BwHzGiNe0Z76QmaaQgKYKiFQJq43fWH3E-MTQwP7JsPut-IIPAZExeiBgOdBUZQPRUh3Frn2ZnasjKVZxw2P7jHOYkA123VSplqatV9fd46vafO4p_oo6UUwjbJGPJ5c3rNqPZW8iK6evf2NnGuOtiWmYOGDaaR5FZizL0IeqKWQrpqHIgVGl_HpmWqsPKczl1dF9_xJv6k6x37U9yVQM9z5DYesT-zB618sxB4k4laakxiGQsnx3ItmGjV_3NBRrcR26WRzYggLWc4emuBoRwZLeU2eNsawqLXpSD3t7BdvukS8kp_qtzQc95ademfsPZitT0kzVj9ri0_2lUVMhhBo3Ka6N5rEp7QIg6J_w0EUcsZbgkWHE1_2lgU43wv9X-arZ1FulD5KLHGXZZAI9GR4lwv6LTyqjB9qOHMi1GNLpCZnHLUnoXJ9KZGDrCdhTjGZifASl4Qq14B3zAPU4FOYkPtm96Sr_vdZYgk=w1000?authuser=0",参数:"amount=1&cost=5000&cost_type=25&item_id=37",备注:"同条件下, 价格比体力药水(小)贵, 与体力药水(大)相同",版本:"",_imageFields:"图片"},{兑换物品名称:"体力药水(大)",图片:"https://lh3.googleusercontent.com/rd-d/ALs6j_HH7F7eZdnIppJzPZNcYnXOkZZqnWMVBktI8FP2uRhLAWY1YK42CuwTUiKCObogvNy3Lc9EeryyraiE2szogs5Yh74sCsm9r-GSYmmcUilqJU28QGN1ToUWlkMiwBVlIuMRv22GlqBo3CMBouXlxggSXyXrnCStsPntrhgC5Rjail73gRsRCyEP_6hF4LTSzvqAb7V7MhaBkh1CHdPx6NEFcBsqb0-c7kddB3Hh5vpELsF7yt-FeDoQAEw0xeKLiQRL4QU7ZcCImLnK_abQJ2GmXm3r_ikdWTEnX0wQSh7qTTAtll_AEJLTiH0j_BHD3-qvHfZZdtqAtN_iKLvjgJfYdY4zNsGVx4rnKsFuYj_Jk4a7Tpx6_rSyZKqjlcclRRqTzp82vG0f0a_UIHxGnLU3t750aa_vo6yWKexdZtzZ24TuTdbRgaxAUldzGryCn2RK1MumUcnn8dOGtE0iLBkUwzVknroZnOzTxGoDNDaGQvSkP8nr4-l9L-2S7oMh_03vHhPuhdDUaC6QS70fPRPzqSYS5MdC3i7LgSABwSbRNuRLMXtYpP5S6ycdPu0ThaDpmJU-wGQtfP6Jd3RUb7xjLadrvNV1iMRXG-NOVY6F5XPce3jAOPVrnmR1L8D5BrDHI6lqmLkVWtDciVkfdwZSXxyTRpMrcwucTl-obGgOfTxwn0EtaMSErXvAm-cBhsZp6cbhXH4sSRjadyzsIhxcOiKcq72Y-YZYgEs1Ao8qsHUBqYEkCfJnKz8gMQTHcTtOJL2xfpZNsKFlvaC1OA79sT0PLAlHD-IoXm9mPfab9wb0Q_WbMAObTb0d_KAVn7u0PGfY5zvgDUGXoIRZo7LkCm1on3zGQWkXeQzRoUTPFGfVoWvCkknkdvpJdiH_6OjQDd00_O9RpF6eT9w3yAfhH-v_HFplUZgTXfJl7O7de0leMMVtH5St7hOqkvTzzW7SHNo8P9GRqHgLbN7sJpaxIKJ_I9l9haBzghkbMG9PcHEeco0deT8=w1000?authuser=0",参数:"amount=1&cost=10000&cost_type=25&item_id=38",备注:"",版本:"",_imageFields:"图片"}];function xt(){const v=_([]),s=N({}),c=_([]);async function I(l){const{action:i,force:r,sheetId:g,sheetName:m=""}=l;let y=null;const w=i[m]||i.default,b=w.copy,S=w.render,H=b?b.split(","):[],D=S?S.split(","):[];let A=null;if(r){const x=await yt({sheetId:g,sheetName:m});if(x.success){y=x.data,A=x.extraData;const O=[],k=Object.keys(K[0]).filter(L=>!L.startsWith("_"));let U=y.length-1;for(const L of K){const P={};for(const R of k)P[R]=L[R];const Z=L._imageFields;if(U++,Z)for(const R of Z.split(","))A.imageFields.push(`${U}:${R}`);O.push(P)}y.push(...O),Object.assign(s,x.source),localStorage.setItem("exchange-data",JSON.stringify(x))}}else{const x=JSON.parse(localStorage.getItem("exchange-data")||"{}");y=x.data,A=x.extraData,Object.assign(s,x.source)}c.value=Object.keys(y[0]);for(let x=0;x<y.length;x++){const O=y[x];for(const k of c.value)O[k]={value:O[k]},H.includes(k)?O[k].copy=!0:D.includes(k)&&O[k].value?.startsWith("http")&&(O[k].renderImage=!0)}v.value=y}return{list:v,fields:c,queryExchangeData:I,spreadsheetSource:s}}function bt(){const v=N({});async function s(c,I){const i=new Date().getTime();if(!c){const g=localStorage.getItem("exchange-data-config");let m=g?JSON.parse(g):null;if(m&&+m.expiration>i){Object.assign(v,m);return}}for(const g of Object.keys(v))delete v[g];const r=await ht({client:I});Object.assign(v,r),v.expiration=i+3600*12*1e3,localStorage.setItem("exchange-data-config",JSON.stringify(v)),v.force=!0}return{config:v,queryExchangeDataConfig:s}}const wt={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]},data1:{type:Object,default:()=>({})}},emits:["update:visible","close","refresh","copy"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh",!0)},copy(v,s){this.$emit("copy",{content:v,row:s})}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]},key2Data1(){return Object.keys(this.data1)}}},_t={class:"modal-content",style:{padding:"0 10px"}},kt={class:"modal-header"},It={key:0,class:"desc"},St={key:1,class:"modal-body data-state"},Ot={key:2,class:"modal-body loading-state"},Ct={key:3,class:"modal-body error-state"},Tt={class:"error-text"},Dt={key:4,class:"modal-body data-state"},Ut={class:"sticky-cell"},At=["src"],Lt=["title"],Rt=["onClick"],Ht={style:{"margin-top":"10px"}},Et={key:5,class:"modal-body empty-state"};function qt(v,s,c,I,l,i){return V((p(),f("div",{class:"modal-overlay",onClick:s[3]||(s[3]=gt((...r)=>i.handleOverlayClick&&i.handleOverlayClick(...r),["self"]))},[a("div",_t,[a("div",kt,[a("h2",null,T(c.title),1),a("button",{class:"close-btn",onClick:s[0]||(s[0]=(...r)=>i.closeModal&&i.closeModal(...r))},"×")]),c.description.length?(p(),f("div",It,[(p(!0),f(q,null,G(c.description,(r,g)=>(p(),f("p",{key:g},T(g+1)+"、"+T(r),1))),128))])):M("",!0),i.key2Data1.length?(p(),f("div",St,[(p(!0),f(q,null,G(c.data1,(r,g)=>(p(),f("p",{key:g},T(g)+": "+T(r),1))),128))])):c.loading?(p(),f("div",Ot,s[4]||(s[4]=[a("div",{class:"loading"},null,-1),a("p",null,"加载数据中...",-1)]))):c.error?(p(),f("div",Ct,[a("p",Tt,"❌ "+T(c.error),1),a("button",{onClick:s[1]||(s[1]=(...r)=>i.refresh&&i.refresh(...r))},"重试")])):c.data&&c.data.length>0?(p(),f("div",Dt,[a("table",null,[a("thead",null,[a("tr",null,[(p(!0),f(q,null,G(i.tabHeaders,(r,g)=>(p(),f("th",{key:g},[a("div",Ut,T(r||`列 ${g+1}`),1)]))),128))])]),a("tbody",null,[(p(!0),f(q,null,G(c.data,(r,g)=>(p(),f("tr",{key:g},[(p(!0),f(q,null,G(r,(m,y)=>(p(),f("td",{key:y},[m.renderImage?(p(),f("img",{key:0,src:m.value,referrerpolicy:"no-referrer"},null,8,At)):(p(),f("div",{key:1,class:"multi-line",title:m.value},[a("span",null,T(m.value),1)],8,Lt)),m.copy?(p(),f("button",{key:2,class:"btn-copy",onClick:w=>i.copy(m.value,r)}," 复制 ",8,Rt)):M("",!0)]))),128))]))),128))])]),a("div",Ht,[a("button",{onClick:s[2]||(s[2]=(...r)=>i.refresh&&i.refresh(...r))},"刷新数据")])])):(p(),f("div",Et,s[5]||(s[5]=[a("p",null,"暂无数据",-1)])))])],512)),[[ut,c.visible]])}const J=dt(wt,[["render",qt],["__scopeId","data-v-429c2e2d"]]),Gt={class:"container1"},zt={style:{"margin-bottom":"5px"}},Pt={style:{"margin-bottom":"5px"}},Zt={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},jt={style:{"margin-bottom":"5px"}},Nt={key:0},Qt={style:{display:"flex","align-items":"flex-start"}},Vt=["disabled"],Mt={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},Wt=["innerHTML"],j="cost",z="amount",X="curl",Bt="PowerShell",Q="fetch",Kt={__name:"exchange-api-param-generator",setup(v){const s=_(""),c=_(!1),I=_(""),l=N({type:"",part1:null,part2:null,part3:null,extra:null}),i=_(""),r=_(""),g=_(!1),m=_(!1),y=_(""),w=_(!1),b=_(!1),S=_(!1),H=/[\-]+\w+\s+/,{config:D,queryExchangeDataConfig:A}=bt(),{list:x,queryExchangeData:O,spreadsheetSource:k}=xt(),U=N({message:""}),L=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],P=ft(()=>{if(k.spreadsheetUrl){const e=[...L];return e[0]+=`: ${k.spreadsheetUrl}`,e}return L});function Z({content:e,row:t}){e&&(navigator.clipboard.writeText(e),window.alert("复制成功"))}function R(e="info"){return(...t)=>{$(e,...t)}}function $(e,t){let o=localStorage.getItem("log_info");const n=`[${new Date().toLocaleString()}] - ${e} - ${t}`;o?o+=`; ${n}`:o=n,localStorage.setItem("log_info",o)}function tt(){g.value=!0,x.value.length||W(!1)}function et(){const e={userAgent:navigator.userAgent,clearLog(){localStorage.removeItem("log_info")}},t=localStorage.getItem("log_info");return t&&(e.log=t),e}async function W(e){x.value.length&&(x.value.length=0),m.value=!0;const t=localStorage.getItem("loggedKey"),o=t?parseInt(t):0;let u="";const n=new Date,d=n.getTime();let h;if(o<d){const{clearLog:C,...E}=et();h=C,E.log&&(n.setHours(24,0,0,0),u=encodeURIComponent(JSON.stringify(E)),localStorage.setItem("loggedKey",n.getTime()))}try{await A(e,u),await O({...D}),y.value&&(y.value=""),h&&h()}catch(C){console.log("拉取数据失败"),console.log(C),y.value="拉取数据失败, 请检查网络或联系管理员"}finally{m.value=!1}}function ot(e,t){let o="--data-raw",u=e.lastIndexOf(o);if(u===-1&&(o="--data-binary",u=e.lastIndexOf(o)),u===-1)return;u+=o.length,t.type=X,t.part1=e.slice(0,u);let n=e.slice(u);const d=n.match(H);d&&(t.part3=n.slice(d.index),n=n.slice(0,d.index)),n=n.trim().slice(1,-1),t.part2=n;const h=t.part1.match(/curl.*?["'](.*?)["']/),C={url:h?h[1]:""};t.extra=C}function at(e,t){const o="-Body";let u=e.lastIndexOf(o);if(u===-1)return;u+=o.length,t.type=Bt,t.part1=e.slice(0,u);let n=e.slice(u);const d=n.match(H);d&&(t.part3=n.slice(d.index),n=n.slice(0,d.index)),n=n.trim().slice(1,-1),t.part2=n;const h=t.part1.match(/Invoke-WebRequest.*?["'](.*?)["']/),C={url:h?h[1]:""};t.extra=C}function st(e,t){t.type=Q;const o=e.match(/^fetch\((.*?)\);$/s);if(o){const n=o[1],d=n.indexOf(",");if(d!=-1){const h={url:n.slice(1,d-1),options:new Function(`return ${n.slice(d+1)}`)()};t.part1=h.url,t.part2=h.options.body,t.extra=h}}}function nt(){let e=s.value;if(!e){window.alert("请输入抓包参数");return}if(e.startsWith(X)?ot(e,l):e.startsWith("Invoke-WebRequest")||e.startsWith("$session")?at(e,l):e.startsWith(Q)&&st(e,l),!l.part1||!l.part2)return window.alert("解析失败, 参数格式是否正确?");const t=l.part2.split("&");t.sort();const o={};for(const u of t){let[n,d]=u.split("=");if(n===j)if(d=decodeURIComponent(d),d.startsWith("[")){d=JSON.parse(d.replace(/\+/g,""));for(const h of d)h.unit=h.value/o[z]}else o.costUnit=d/o[z];o[n]=d}if(!o[z]&&!o[j]){window.alert("请输入正确的抓包参数");return}l.part2Parsed=o,c.value=!0,I.value=o[z]}function lt(){let e=r.value;if(!e){window.alert("请输入兑换数量");return}if(e=e>>0,e<1){window.alert("请输入正确的兑换数量");return}let t="";const o={...l.part2Parsed};o[z]=e;let u;const n=o[j];Array.isArray(n)||(u=o.costUnit,delete o.costUnit);for(const d in o)if(d===j)if(u)t+=`${d}=${u*e}&`;else{const h=[];for(const C of n){const E={...C};E.value=""+C.unit*e,delete E.unit,h.push(E)}t+=`${d}=${encodeURIComponent(JSON.stringify(h))}&`}else t+=`${d}=${o[d]}&`;t=t.slice(0,-1),l.extra._params=t,l.type===Q?(i.value=`fetch('${l.part1}', ${JSON.stringify({...l.extra.options,body:t})});`,w.value=!0):(i.value=`${l.part1} '${t}'`,l.part3&&(i.value+=` ${l.part3}`))}function it(){if(i.value){navigator.clipboard.writeText(i.value);const e=`copy:command:${l.type};${l.extra.url||"-"};${decodeURIComponent(l.extra._params)}`;R()(e),window.alert("复制成功")}}async function rt(){if(!w.value||S.value)return;S.value=!0,setTimeout(()=>{S.value=!1},5e3);const e=await fetch(l.extra.url,{...l.extra.options,body:l.extra._params});U.status_code=e.status;let t=`execute:command:${l.type};${l.extra.url||"-"};${decodeURIComponent(l.extra._params)}`;try{t+=";ok";const o=await e.json();Object.assign(U,o)}catch(o){console.log(o),t+=";error";try{const u=await e.text();U.respText=u}catch(u){console.log(u)}U.message="请求失败, 网络或参数错误"}finally{b.value=!0,R()(t)}}function ct(){i.value&&(i.value=""),c.value&&(c.value=!1),s.value&&(s.value=""),r.value&&(r.value=""),w.value&&(w.value=!1)}return(e,t)=>(p(),f("div",Gt,[t[6]||(t[6]=a("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),t[7]||(t[7]=a("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),t[8]||(t[8]=a("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),a("div",zt,[a("div",Pt,[t[4]||(t[4]=a("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),a("div",Zt,[V(a("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o),placeholder:"请输入",id:"command",style:{width:"500px","margin-right":"10px"},rows:"6"},null,512),[[F,s.value]])]),a("div",jt,[a("button",{onClick:tt,style:{"margin-right":"10px"}},"浏览参数"),a("button",{onClick:nt,style:{"margin-right":"10px"}},"解析"),c.value?(p(),f("span",Nt," 成功, 当前兑换数量为: "+T(I.value),1)):M("",!0)])]),a("div",null,[t[5]||(t[5]=a("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),a("div",Qt,[V(a("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":t[1]||(t[1]=o=>r.value=o)},null,512),[[F,r.value,void 0,{number:!0}]]),a("button",{onClick:lt,style:{"margin-right":"10px",cursor:"pointer"}},"生成"),a("button",{onClick:it,style:{"margin-right":"10px",cursor:"pointer"}},"复制"),a("button",{onClick:ct,style:{"margin-right":"10px",cursor:"pointer"}},"清除"),a("button",{disabled:!w.value||S.value,onClick:rt,style:vt({cursor:w.value&&!S.value?"pointer":"not-allowed"})},"执行",12,Vt)])]),a("div",Mt,[a("div",{innerHTML:i.value},null,8,Wt)])]),t[9]||(t[9]=pt('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...,</div><div style="font-size:13px;">若是fetch, 则以fetch开头, 并且可直接在当前网页上执行</div>',6)),B(J,{visible:g.value,"onUpdate:visible":t[2]||(t[2]=o=>g.value=o),title:"兑换参数对照表",data:mt(x),description:P.value,onRefresh:W,loading:m.value,error:y.value,onCopy:Z},null,8,["visible","data","description","loading","error"]),B(J,{visible:b.value,"onUpdate:visible":t[3]||(t[3]=o=>b.value=o),title:"执行fetch命令",data1:U},null,8,["visible","data1"])]))}};export{Kt as default};
