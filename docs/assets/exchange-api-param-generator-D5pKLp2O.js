import{r as h,a as D,_ as G,w as C,v as F,c as v,b as t,d as E,t as b,F as k,e as O,f as K,o as g,g as J,h as Q,i as W,j as L,k as $,u as Y}from"./index-DzvmQFja.js";async function Z(p){const{sheetId:n,sheetName:l=""}=p;let u=`https://script.google.com/macros/s/AKfycbzf3AIetwEitGy5t1ORgW2JW5HgMzOHw-kZRM_cQrFny3fGFL9_PcRI3re3T52BghBF/exec?sheetId=${n}&sheetName=${l}`;return await(await fetch(u,{method:"GET",redirect:"follow"})).json()}async function ee(){return await(await fetch("https://script.google.com/macros/s/AKfycbyRrP5xSt3A_fyTieysOFgv2gljQI2iunJEc0CRijOlOTOXiNesbNX2-GZyRRFVRXFe/exec",{method:"GET",redirect:"follow"})).json()}function te(){const p=h([]),n=D({}),l=h([]);async function m(u){let i=null;if(u.force){const a=await Z(u);a.success&&(i=a.data,Object.assign(n,a.source),localStorage.setItem("exchange-data",JSON.stringify(a)))}else{const a=JSON.parse(localStorage.getItem("exchange-data")||"{}");i=a.data,Object.assign(n,a.source)}l.value=Object.keys(i[0]);for(const a of i)for(const d of l.value)a[d]={value:a[d]},d=="图片"?a[d].value.startsWith("http")&&(a[d].renderImage=!0):d=="参数"&&(a[d].copy=!0);p.value=i}return{list:p,fields:l,queryExchangeDataList:m,spreadsheetSource:n}}function ae(){const p=D({});async function n({force:l}={}){const m=new Date;if(!l){const i=localStorage.getItem("exchange-data-config");let a=i?JSON.parse(i):null;if(a&&+a.expiration>m.getTime()){Object.assign(p,a);return}}const u=await ee();Object.assign(p,u),p.expiration=m.setHours(24,0,0,0),p.force=!0,localStorage.setItem("exchange-data-config",JSON.stringify(p))}return{config:p,queryExchangeDataConfig:n}}const ie={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]}},emits:["update:visible","close","refresh"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh")},copy(p){p&&(navigator.clipboard.writeText(p),window.alert("复制成功"))}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]}}},se={class:"modal-content",style:{padding:"0 10px"}},ne={class:"modal-header"},oe={class:"desc"},le={key:0,class:"modal-body loading-state"},re={key:1,class:"modal-body data-state"},de=["src"],ce={key:1,class:"multi-line"},ue=["onClick"],pe={style:{"margin-top":"10px"}},fe={key:2,class:"modal-body empty-state"};function ve(p,n,l,m,u,i){return C((g(),v("div",{class:"modal-overlay",onClick:n[2]||(n[2]=K((...a)=>i.handleOverlayClick&&i.handleOverlayClick(...a),["self"]))},[t("div",se,[t("div",ne,[t("h2",null,b(l.title),1),t("button",{class:"close-btn",onClick:n[0]||(n[0]=(...a)=>i.closeModal&&i.closeModal(...a))},"×")]),t("div",oe,[(g(!0),v(k,null,O(l.description,(a,d)=>(g(),v("p",{key:d},b(d+1)+"、"+b(a),1))),128))]),l.loading?(g(),v("div",le,n[3]||(n[3]=[t("div",{class:"loading"},null,-1),t("p",null,"加载数据中...",-1)]))):E("",!0),l.data&&l.data.length>0?(g(),v("div",re,[t("table",null,[t("thead",null,[t("tr",null,[(g(!0),v(k,null,O(i.tabHeaders,(a,d)=>(g(),v("th",{key:d},b(a||`列 ${d+1}`),1))),128))])]),t("tbody",null,[(g(!0),v(k,null,O(l.data,(a,d)=>(g(),v("tr",{key:d},[(g(!0),v(k,null,O(a,(y,w)=>(g(),v("td",{key:w},[y.renderImage?(g(),v("img",{key:0,src:y.value,referrerpolicy:"no-referrer"},null,8,de)):(g(),v("div",ce,[t("span",null,b(y.value),1)])),y.copy?(g(),v("button",{key:2,class:"btn-copy",onClick:I=>i.copy(y.value)}," 复制 ",8,ue)):E("",!0)]))),128))]))),128))])]),t("div",pe,[t("button",{onClick:n[1]||(n[1]=(...a)=>i.refresh&&i.refresh(...a))},"刷新数据")])])):(g(),v("div",fe,n[4]||(n[4]=[t("p",null,"暂无数据",-1)])))])],512)),[[F,l.visible]])}const ge=G(ie,[["render",ve],["__scopeId","data-v-4c9b8e42"]]),ye={class:"container1"},me={style:{"margin-bottom":"5px"}},he={style:{"margin-bottom":"5px"}},xe={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},be={style:{"margin-bottom":"5px"}},we={key:0},ke={style:{display:"flex","align-items":"flex-start"}},Oe={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},_e=["innerHTML"],S="cost",_="amount",N="curl",Ie="PowerShell",Ce={__name:"exchange-api-param-generator",setup(p){const n=h(""),l=h(!1),m=h(""),u=D({type:"",part1:null,part2:null,part3:null}),i=h(""),a=h(""),d=h(!1),y=h(!1),w=/[\-]+\w+\s+/,{config:I,queryExchangeDataConfig:A}=ae(),{list:T,queryExchangeDataList:H,spreadsheetSource:U}=te(),R=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],M=J(()=>{if(U.spreadsheetUrl){const o=[...R];return o[0]+=`: ${U.spreadsheetUrl}`,o}return R});Q(async()=>{y.value=!0,await A(),await H(I),y.value=!1});async function V(){T.value.length=0,y.value=!0,await A({force:!0}),await H(I),y.value=!1}function j(o,e){let s="--data-raw",c=o.lastIndexOf(s);if(c===-1&&(s="--data-binary",c=o.lastIndexOf(s)),c===-1)return;c+=s.length,e.type=N,e.part1=o.slice(0,c);let r=o.slice(c);const f=r.match(w);f&&(e.part3=r.slice(f.index),r=r.slice(0,f.index)),r=r.trim().slice(1,-1),e.part2=r}function q(o,e){const s="-Body";let c=o.lastIndexOf(s);if(c===-1)return;c+=s.length,e.type=Ie,e.part1=o.slice(0,c);let r=o.slice(c);const f=r.match(w);f&&(e.part3=r.slice(f.index),r=r.slice(0,f.index)),r=r.trim().slice(1,-1),e.part2=r}function B(){let o=n.value;if(!o){window.alert("请输入抓包参数");return}if(o.startsWith(N)?j(o,u):o.startsWith("Invoke-WebRequest")&&q(o,u),!u.part1||!u.part2)return window.alert("解析失败, 参数格式是否正确?");const e=u.part2.split("&");e.sort();const s={};for(const c of e){let[r,f]=c.split("=");if(r===S){f=decodeURIComponent(f),f=JSON.parse(f.replace(/\+/g,""));for(const x of f)x.unit=x.value/s[_]}s[r]=f}if(!s[_]&&!s[S]){window.alert("请输入正确的抓包参数");return}u.part2Parsed=s,l.value=!0,m.value=s[_]}function P(){let o=a.value;if(!o){window.alert("请输入兑换数量");return}if(o=o>>0,o<1){window.alert("请输入正确的兑换数量");return}let e="";const s={...u.part2Parsed};s[_]=o;for(const c in s)if(c===S){const r=[];for(const f of s[c]){const x={...f};x.value=""+f.unit*o,delete x.unit,r.push(x)}e+=`${c}=${encodeURIComponent(JSON.stringify(r))}&`}else e+=`${c}=${s[c]}&`;i.value=`${u.part1} '${e.slice(0,-1)}'`,u.part3&&(i.value+=` ${u.part3}`)}function X(){i.value&&(navigator.clipboard.writeText(i.value),window.alert("复制成功"))}function z(){i.value&&(i.value=""),l.value&&(l.value=!1),n.value&&(n.value="")}return(o,e)=>(g(),v("div",ye,[e[6]||(e[6]=t("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),e[7]||(e[7]=t("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),e[8]||(e[8]=t("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),t("div",me,[t("div",he,[e[4]||(e[4]=t("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),t("div",xe,[C(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),placeholder:"请输入",id:"command",style:{width:"360px","margin-right":"10px"},rows:"4"},null,512),[[$,n.value]])]),t("div",be,[t("button",{onClick:e[1]||(e[1]=s=>d.value=!0),style:{"margin-right":"10px"}},"浏览参数"),t("button",{onClick:B,style:{"margin-right":"10px"}},"解析"),l.value?(g(),v("span",we," 成功, 当前兑换数量为: "+b(m.value),1)):E("",!0)])]),t("div",null,[e[5]||(e[5]=t("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),t("div",ke,[C(t("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":e[2]||(e[2]=s=>a.value=s)},null,512),[[$,a.value,void 0,{number:!0}]]),t("button",{onClick:P,style:{"margin-right":"10px"}},"生成"),t("button",{onClick:X,style:{"margin-right":"10px"}},"复制"),t("button",{onClick:z},"清除")])]),t("div",Oe,[t("div",{innerHTML:i.value},null,8,_e)])]),e[9]||(e[9]=W('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...</div>',5)),L(ge,{visible:d.value,"onUpdate:visible":e[3]||(e[3]=s=>d.value=s),title:"兑换参数对照表",data:Y(T),description:M.value,onRefresh:V,loading:y.value},null,8,["visible","data","description","loading"])]))}};export{Ce as default};
