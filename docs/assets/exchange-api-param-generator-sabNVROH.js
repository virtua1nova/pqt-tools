import{r as b,a as V,_ as z,w as H,v as G,c as f,b as t,d as R,t as C,F as $,e as A,f as K,o as v,g as J,h as Q,i as L,j as W,k as q,u as Y}from"./index-Dt9NuFbl.js";async function Z(u){const{sheetId:s,sheetName:l="",deploymentId:h}=u;let n=`${`https://script.google.com/macros/s/${h}/exec`}?sheetId=${s}&sheetName=${l}`;return await(await fetch(n,{method:"GET",redirect:"follow"})).json()}async function ee(){return await(await fetch("https://script.google.com/macros/s/AKfycbyRrP5xSt3A_fyTieysOFgv2gljQI2iunJEc0CRijOlOTOXiNesbNX2-GZyRRFVRXFe/exec",{method:"GET",redirect:"follow"})).json()}function te(){const u=b([]),s=V({}),l=b([]);async function h(g){const{action:n,force:o,sheetId:m,sheetName:y="",deploymentId:k}=g;let x=null;const O=n[y].copy,T=O?O.split(","):[];let _=null;if(o){const d=await Z({sheetId:m,sheetName:y,deploymentId:k});d.success&&(x=d.data,_=d.extraData,Object.assign(s,d.source),localStorage.setItem("exchange-data",JSON.stringify(d)))}else{const d=JSON.parse(localStorage.getItem("exchange-data")||"{}");x=d.data,_=d.extraData,Object.assign(s,d.source)}const E=_.imageFields||[];l.value=Object.keys(x[0]);const D={};for(const d of E)D[d]=1;for(let d=0;d<x.length;d++){const I=x[d];for(const w of l.value)I[w]={value:I[w]},D[`${d}:${w}`]?I[w].renderImage=!0:T.includes(w)&&(I[w].copy=!0)}u.value=x}return{list:u,fields:l,queryExchangeDataList:h,spreadsheetSource:s}}function ae(){const u=V({});async function s(l){const h=new Date;if(!l){const n=localStorage.getItem("exchange-data-config");let o=n?JSON.parse(n):null;if(o&&+o.expiration>h.getTime()){Object.assign(u,o);return}}const g=await ee();Object.assign(u,g),u.expiration=h.setHours(24,0,0,0),u.force=!0,localStorage.setItem("exchange-data-config",JSON.stringify(u))}return{config:u,queryExchangeDataConfig:s}}const ie={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]}},emits:["update:visible","close","refresh"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh",!0)},copy(u){u&&(navigator.clipboard.writeText(u),window.alert("复制成功"))}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]}}},se={class:"modal-content",style:{padding:"0 10px"}},ne={class:"modal-header"},oe={class:"desc"},le={key:0,class:"modal-body loading-state"},re={key:1,class:"modal-body data-state"},de=["src"],ce={key:1,class:"multi-line"},ue=["onClick"],pe={style:{"margin-top":"10px"}},fe={key:2,class:"modal-body empty-state"};function ve(u,s,l,h,g,n){return H((v(),f("div",{class:"modal-overlay",onClick:s[2]||(s[2]=K((...o)=>n.handleOverlayClick&&n.handleOverlayClick(...o),["self"]))},[t("div",se,[t("div",ne,[t("h2",null,C(l.title),1),t("button",{class:"close-btn",onClick:s[0]||(s[0]=(...o)=>n.closeModal&&n.closeModal(...o))},"×")]),t("div",oe,[(v(!0),f($,null,A(l.description,(o,m)=>(v(),f("p",{key:m},C(m+1)+"、"+C(o),1))),128))]),l.loading?(v(),f("div",le,s[3]||(s[3]=[t("div",{class:"loading"},null,-1),t("p",null,"加载数据中...",-1)]))):R("",!0),l.data&&l.data.length>0?(v(),f("div",re,[t("table",null,[t("thead",null,[t("tr",null,[(v(!0),f($,null,A(n.tabHeaders,(o,m)=>(v(),f("th",{key:m},C(o||`列 ${m+1}`),1))),128))])]),t("tbody",null,[(v(!0),f($,null,A(l.data,(o,m)=>(v(),f("tr",{key:m},[(v(!0),f($,null,A(o,(y,k)=>(v(),f("td",{key:k},[y.renderImage?(v(),f("img",{key:0,src:y.value,referrerpolicy:"no-referrer"},null,8,de)):(v(),f("div",ce,[t("span",null,C(y.value),1)])),y.copy?(v(),f("button",{key:2,class:"btn-copy",onClick:x=>n.copy(y.value)}," 复制 ",8,ue)):R("",!0)]))),128))]))),128))])]),t("div",pe,[t("button",{onClick:s[1]||(s[1]=(...o)=>n.refresh&&n.refresh(...o))},"刷新数据")])])):(v(),f("div",fe,s[4]||(s[4]=[t("p",null,"暂无数据",-1)])))])],512)),[[G,l.visible]])}const ge=z(ie,[["render",ve],["__scopeId","data-v-05e2822c"]]),me={class:"container1"},ye={style:{"margin-bottom":"5px"}},he={style:{"margin-bottom":"5px"}},xe={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},be={style:{"margin-bottom":"5px"}},we={key:0},ke={style:{display:"flex","align-items":"flex-start"}},Oe={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},_e=["innerHTML"],U="cost",N="amount",M="curl",Ie="PowerShell",Ce={__name:"exchange-api-param-generator",setup(u){const s=b(""),l=b(!1),h=b(""),g=V({type:"",part1:null,part2:null,part3:null}),n=b(""),o=b(""),m=b(!1),y=b(!1),k=/[\-]+\w+\s+/,{config:x,queryExchangeDataConfig:j}=ae(),{list:O,queryExchangeDataList:T,spreadsheetSource:_}=te(),E=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],D=J(()=>{if(_.spreadsheetUrl){const a=[...E];return a[0]+=`: ${_.spreadsheetUrl}`,a}return E});Q(()=>{d(!1)});async function d(a){O.value.length&&(O.value.length=0),y.value=!0,await j(a),await T(x),y.value=!1}function I(a,e){let i="--data-raw",c=a.lastIndexOf(i);if(c===-1&&(i="--data-binary",c=a.lastIndexOf(i)),c===-1)return;c+=i.length,e.type=M,e.part1=a.slice(0,c);let r=a.slice(c);const p=r.match(k);p&&(e.part3=r.slice(p.index),r=r.slice(0,p.index)),r=r.trim().slice(1,-1),e.part2=r}function w(a,e){const i="-Body";let c=a.lastIndexOf(i);if(c===-1)return;c+=i.length,e.type=Ie,e.part1=a.slice(0,c);let r=a.slice(c);const p=r.match(k);p&&(e.part3=r.slice(p.index),r=r.slice(0,p.index)),r=r.trim().slice(1,-1),e.part2=r}function X(){let a=s.value;if(!a){window.alert("请输入抓包参数");return}if(a.startsWith(M)?I(a,g):a.startsWith("Invoke-WebRequest")&&w(a,g),!g.part1||!g.part2)return window.alert("解析失败, 参数格式是否正确?");const e=g.part2.split("&");e.sort();const i={};for(const c of e){let[r,p]=c.split("=");if(r===U){p=decodeURIComponent(p),p=JSON.parse(p.replace(/\+/g,""));for(const S of p)S.unit=S.value/i[N]}i[r]=p}if(!i[N]&&!i[U]){window.alert("请输入正确的抓包参数");return}g.part2Parsed=i,l.value=!0,h.value=i[N]}function F(){let a=o.value;if(!a){window.alert("请输入兑换数量");return}if(a=a>>0,a<1){window.alert("请输入正确的兑换数量");return}let e="";const i={...g.part2Parsed};i[N]=a;for(const c in i)if(c===U){const r=[];for(const p of i[c]){const S={...p};S.value=""+p.unit*a,delete S.unit,r.push(S)}e+=`${c}=${encodeURIComponent(JSON.stringify(r))}&`}else e+=`${c}=${i[c]}&`;n.value=`${g.part1} '${e.slice(0,-1)}'`,g.part3&&(n.value+=` ${g.part3}`)}function P(){n.value&&(navigator.clipboard.writeText(n.value),window.alert("复制成功"))}function B(){n.value&&(n.value=""),l.value&&(l.value=!1),s.value&&(s.value="")}return(a,e)=>(v(),f("div",me,[e[6]||(e[6]=t("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),e[7]||(e[7]=t("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),e[8]||(e[8]=t("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),t("div",ye,[t("div",he,[e[4]||(e[4]=t("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),t("div",xe,[H(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=i=>s.value=i),placeholder:"请输入",id:"command",style:{width:"360px","margin-right":"10px"},rows:"4"},null,512),[[q,s.value]])]),t("div",be,[t("button",{onClick:e[1]||(e[1]=i=>m.value=!0),style:{"margin-right":"10px"}},"浏览参数"),t("button",{onClick:X,style:{"margin-right":"10px"}},"解析"),l.value?(v(),f("span",we," 成功, 当前兑换数量为: "+C(h.value),1)):R("",!0)])]),t("div",null,[e[5]||(e[5]=t("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),t("div",ke,[H(t("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":e[2]||(e[2]=i=>o.value=i)},null,512),[[q,o.value,void 0,{number:!0}]]),t("button",{onClick:F,style:{"margin-right":"10px"}},"生成"),t("button",{onClick:P,style:{"margin-right":"10px"}},"复制"),t("button",{onClick:B},"清除")])]),t("div",Oe,[t("div",{innerHTML:n.value},null,8,_e)])]),e[9]||(e[9]=L('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...</div>',5)),W(ge,{visible:m.value,"onUpdate:visible":e[3]||(e[3]=i=>m.value=i),title:"兑换参数对照表",data:Y(O),description:D.value,onRefresh:d,loading:y.value},null,8,["visible","data","description","loading"])]))}};export{Ce as default};
