import{r as _,a as Z,_ as dt,w as V,v as ut,c as f,b as s,d as j,t as T,F as H,e as q,f as ft,o as p,g as pt,h as gt,i as B,j as J,n as vt,u as mt}from"./index-C6OHql6P.js";async function yt(g){const{sheetId:o,sheetName:l=""}=g,{cancel:O,controller:d}=Y(15e3),n=`https://docs.google.com/spreadsheets/d/${o}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(l)}`,r=await fetch(n,{method:"GET",redirect:"follow",signal:d.signal});O();const v=(await r.text()).replace(/\"/g,"").split(`
`).map(x=>x.split(",")),y=v[0].filter(x=>x),b=[];for(let x=1;x<v.length;x++){const I={},R=v[x];for(let C=0;C<y.length;C++){const U=R[C];I[y[C]]=U}b.push(I)}return{success:!0,source:{sheetName:l,spreadsheetUrl:`https://docs.google.com/spreadsheets/d/${o}/edit`},data:b,extraData:{imageFields:[]}}}function Y(g){const o=new AbortController,l=setTimeout(()=>{o.abort()},g);return{controller:o,cancel:()=>{clearTimeout(l)}}}async function ht(g){const{client:o=""}=g,{cancel:l,controller:O}=Y(15e3);let n=`${`https://script.google.com/macros/s/AKfycbyRrP5xSt3A_fyTieysOFgv2gljQI2iunJEc0CRijOlOTOXiNesbNX2-GZyRRFVRXFe/exec?client=${o}`}`;const r=await fetch(n,{method:"GET",redirect:"follow",signal:O.signal});return l(),await r.json()}const W=[{兑换物品名称:"体力药水(小)",图片:"https://lh3.googleusercontent.com/d/1M_1Zvh24BKTtiz-PkHfPEcpX22wb-kyW=w1000?authuser=0",参数:"item_id=36&cost_type=25&cost=4800&amount=1",备注:"需要将原始抓包数据的store_id与网站提供的参数拼接, 且需要在金币商店中刷出药水的时候才可使用。",版本:"",_imageFields:"图片"},{兑换物品名称:"体力药水(中)",图片:"https://lh3.googleusercontent.com/rd-d/ALs6j_GsgQnuYAfGd63MBHIqYtczmSfQFb37-ZNmHzq4WoYJVFdbmDuIyNfvmtKq-bHIkQYMdMGJln-VmNdPWoR5Qj9la5327jQ--Vxks2yD7RPx5XQCZpyXSWwcZ6gude58bPXyminyvb1EHIbFUh5TrGTDTh0w-mCv3Jlgg6muT_injSk3j1ATTMvsMzXeGuqc5V2tL3OqEW9edOYpbG32rbp8eLg-SV3IdVKjGS92SALGdzVZN2s9-7DrWil4u-XrJCI92hLrwEpdcZWas_YZtnCDi-bJRAsAogCoXdw9FrJAsFyZlSiRXOVpSlJTfKvBZ1v_R_n4e5GUc9LbBcyoQhRWcz4c5LpbmaKZIRObcogDsURculRrkkfVU5EJWo7wJKC12jtzHQdOlY31xvPNgWt3pg64z99jJzIdUMWiPhMDusBrPdqQzBCaDgGZyA5zCtH7IWhnnutgw6-mCdCb7qQ_3rDvuL7iC28g04T0EbT_0kCA_V1MLCFwQ4PrO4wFL4nlxwFvUN1ImLW9BwHzGiNe0Z76QmaaQgKYKiFQJq43fWH3E-MTQwP7JsPut-IIPAZExeiBgOdBUZQPRUh3Frn2ZnasjKVZxw2P7jHOYkA123VSplqatV9fd46vafO4p_oo6UUwjbJGPJ5c3rNqPZW8iK6evf2NnGuOtiWmYOGDaaR5FZizL0IeqKWQrpqHIgVGl_HpmWqsPKczl1dF9_xJv6k6x37U9yVQM9z5DYesT-zB618sxB4k4laakxiGQsnx3ItmGjV_3NBRrcR26WRzYggLWc4emuBoRwZLeU2eNsawqLXpSD3t7BdvukS8kp_qtzQc95ademfsPZitT0kzVj9ri0_2lUVMhhBo3Ka6N5rEp7QIg6J_w0EUcsZbgkWHE1_2lgU43wv9X-arZ1FulD5KLHGXZZAI9GR4lwv6LTyqjB9qOHMi1GNLpCZnHLUnoXJ9KZGDrCdhTjGZifASl4Qq14B3zAPU4FOYkPtm96Sr_vdZYgk=w1000?authuser=0",参数:"amount=1&cost=5000&cost_type=25&item_id=37",备注:"同条件下, 价格比体力药水(小)贵, 与体力药水(大)相同",版本:"",_imageFields:"图片"},{兑换物品名称:"体力药水(大)",图片:"https://lh3.googleusercontent.com/rd-d/ALs6j_HH7F7eZdnIppJzPZNcYnXOkZZqnWMVBktI8FP2uRhLAWY1YK42CuwTUiKCObogvNy3Lc9EeryyraiE2szogs5Yh74sCsm9r-GSYmmcUilqJU28QGN1ToUWlkMiwBVlIuMRv22GlqBo3CMBouXlxggSXyXrnCStsPntrhgC5Rjail73gRsRCyEP_6hF4LTSzvqAb7V7MhaBkh1CHdPx6NEFcBsqb0-c7kddB3Hh5vpELsF7yt-FeDoQAEw0xeKLiQRL4QU7ZcCImLnK_abQJ2GmXm3r_ikdWTEnX0wQSh7qTTAtll_AEJLTiH0j_BHD3-qvHfZZdtqAtN_iKLvjgJfYdY4zNsGVx4rnKsFuYj_Jk4a7Tpx6_rSyZKqjlcclRRqTzp82vG0f0a_UIHxGnLU3t750aa_vo6yWKexdZtzZ24TuTdbRgaxAUldzGryCn2RK1MumUcnn8dOGtE0iLBkUwzVknroZnOzTxGoDNDaGQvSkP8nr4-l9L-2S7oMh_03vHhPuhdDUaC6QS70fPRPzqSYS5MdC3i7LgSABwSbRNuRLMXtYpP5S6ycdPu0ThaDpmJU-wGQtfP6Jd3RUb7xjLadrvNV1iMRXG-NOVY6F5XPce3jAOPVrnmR1L8D5BrDHI6lqmLkVWtDciVkfdwZSXxyTRpMrcwucTl-obGgOfTxwn0EtaMSErXvAm-cBhsZp6cbhXH4sSRjadyzsIhxcOiKcq72Y-YZYgEs1Ao8qsHUBqYEkCfJnKz8gMQTHcTtOJL2xfpZNsKFlvaC1OA79sT0PLAlHD-IoXm9mPfab9wb0Q_WbMAObTb0d_KAVn7u0PGfY5zvgDUGXoIRZo7LkCm1on3zGQWkXeQzRoUTPFGfVoWvCkknkdvpJdiH_6OjQDd00_O9RpF6eT9w3yAfhH-v_HFplUZgTXfJl7O7de0leMMVtH5St7hOqkvTzzW7SHNo8P9GRqHgLbN7sJpaxIKJ_I9l9haBzghkbMG9PcHEeco0deT8=w1000?authuser=0",参数:"amount=1&cost=10000&cost_type=25&item_id=38",备注:"",版本:"",_imageFields:"图片"}];function xt(){const g=_([]),o=Z({}),l=_([]);async function O(d){const{action:n,force:r,sheetId:u,sheetName:v=""}=d;let y=null;const b=n[v]||n.default,x=b.copy,I=b.render,R=x?x.split(","):[],C=I?I.split(","):[];let U=null;if(r){const h=await yt({sheetId:u,sheetName:v});if(h.success){y=h.data,U=h.extraData;const S=[],w=Object.keys(W[0]).filter(A=>!A.startsWith("_"));let D=y.length-1;for(const A of W){const P={};for(const E of w)P[E]=A[E];const z=A._imageFields;if(D++,z)for(const E of z.split(","))U.imageFields.push(`${D}:${E}`);S.push(P)}y.push(...S),Object.assign(o,h.source),localStorage.setItem("exchange-data",JSON.stringify(h))}}else{const h=JSON.parse(localStorage.getItem("exchange-data")||"{}");y=h.data,U=h.extraData,Object.assign(o,h.source)}l.value=Object.keys(y[0]);for(let h=0;h<y.length;h++){const S=y[h];for(const w of l.value)S[w]={value:S[w]},R.includes(w)?S[w].copy=!0:C.includes(w)&&S[w].value?.startsWith("http")&&(S[w].renderImage=!0)}g.value=y}return{list:g,fields:l,queryExchangeData:O,spreadsheetSource:o}}function bt(){const g=Z({});async function o(l,O){const n=new Date().getTime();if(!l){const u=localStorage.getItem("exchange-data-config");let v=u?JSON.parse(u):null;if(v&&+v.expiration>n){Object.assign(g,v);return}}for(const u of Object.keys(g))delete g[u];const r=await ht({client:JSON.stringify(O)});Object.assign(g,r),g.expiration=n+3600*12*1e3,localStorage.setItem("exchange-data-config",JSON.stringify(g)),g.force=!0}return{config:g,queryExchangeDataConfig:o}}const _t={name:"DataModal",props:{visible:{type:Boolean,required:!0},title:{type:String,default:"数据详情"},data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},description:{type:Array,default:()=>[]},data1:{type:Object,default:()=>({})}},emits:["update:visible","close","refresh","copy"],methods:{handleOverlayClick(){this.closeModal()},closeModal(){this.$emit("close"),this.$emit("update:visible",!1)},refresh(){this.$emit("refresh",!0)},copy(g,o){this.$emit("copy",{content:g,row:o})}},computed:{tabHeaders(){return this.data.length?Object.keys(this.data[0]):[]},key2Data1(){return Object.keys(this.data1)}}},wt={class:"modal-content",style:{padding:"0 10px"}},kt={class:"modal-header"},Ot={key:0,class:"desc"},It={key:1,class:"modal-body data-state"},St={key:2,class:"modal-body loading-state"},Ct={key:3,class:"modal-body error-state"},Tt={class:"error-text"},Dt={key:4,class:"modal-body data-state"},Ut={class:"sticky-cell"},At=["src"],Rt=["title"],Et=["onClick"],Ht={style:{"margin-top":"10px"}},qt={key:5,class:"modal-body empty-state"};function Gt(g,o,l,O,d,n){return V((p(),f("div",{class:"modal-overlay",onClick:o[3]||(o[3]=ft((...r)=>n.handleOverlayClick&&n.handleOverlayClick(...r),["self"]))},[s("div",wt,[s("div",kt,[s("h2",null,T(l.title),1),s("button",{class:"close-btn",onClick:o[0]||(o[0]=(...r)=>n.closeModal&&n.closeModal(...r))},"×")]),l.description.length?(p(),f("div",Ot,[(p(!0),f(H,null,q(l.description,(r,u)=>(p(),f("p",{key:u},T(u+1)+"、"+T(r),1))),128))])):j("",!0),n.key2Data1.length?(p(),f("div",It,[(p(!0),f(H,null,q(l.data1,(r,u)=>(p(),f("p",{key:u},T(u)+": "+T(r),1))),128))])):l.loading?(p(),f("div",St,o[4]||(o[4]=[s("div",{class:"loading"},null,-1),s("p",null,"加载数据中...",-1)]))):l.error?(p(),f("div",Ct,[s("p",Tt,"❌ "+T(l.error),1),s("button",{onClick:o[1]||(o[1]=(...r)=>n.refresh&&n.refresh(...r))},"重试")])):l.data&&l.data.length>0?(p(),f("div",Dt,[s("table",null,[s("thead",null,[s("tr",null,[(p(!0),f(H,null,q(n.tabHeaders,(r,u)=>(p(),f("th",{key:u},[s("div",Ut,T(r||`列 ${u+1}`),1)]))),128))])]),s("tbody",null,[(p(!0),f(H,null,q(l.data,(r,u)=>(p(),f("tr",{key:u},[(p(!0),f(H,null,q(r,(v,y)=>(p(),f("td",{key:y},[v.renderImage?(p(),f("img",{key:0,src:v.value,referrerpolicy:"no-referrer"},null,8,At)):(p(),f("div",{key:1,class:"multi-line",title:v.value},[s("span",null,T(v.value),1)],8,Rt)),v.copy?(p(),f("button",{key:2,class:"btn-copy",onClick:b=>n.copy(v.value,r)}," 复制 ",8,Et)):j("",!0)]))),128))]))),128))])]),s("div",Ht,[s("button",{onClick:o[2]||(o[2]=(...r)=>n.refresh&&n.refresh(...r))},"刷新数据")])])):(p(),f("div",qt,o[5]||(o[5]=[s("p",null,"暂无数据",-1)])))])],512)),[[ut,l.visible]])}const X=dt(_t,[["render",Gt],["__scopeId","data-v-429c2e2d"]]),Pt={class:"container1"},zt={style:{"margin-bottom":"5px"}},Nt={style:{"margin-bottom":"5px"}},Zt={style:{display:"flex","align-items":"flex-start","margin-bottom":"5px"}},Ft={style:{"margin-bottom":"5px"}},Lt={key:0},Vt={style:{display:"flex","align-items":"flex-start"}},jt=["disabled"],Qt={style:{"word-break":"break-all","font-size":"13px",color:"#855454","margin-top":"5px"}},Mt=["innerHTML"],N="cost",G="amount",K="curl",Bt="PowerShell",L="fetch",Wt={__name:"exchange-api-param-generator",setup(g){const o=_(""),l=_(!1),O=_(""),d=Z({type:"",part1:null,part2:null,part3:null,extra:null}),n=_(""),r=_(""),u=_(!1),v=_(!1),y=_(""),b=_(!1),x=_(!1),I=_(!1),R=/[\-]+\w+\s+/,{config:C,queryExchangeDataConfig:U}=bt(),{list:h,queryExchangeData:S,spreadsheetSource:w}=xt(),D=Z({message:""}),A=["如果没有看到想要的兑换参数的话, 可前往在线表格帮忙填写","使用方法: 复制 -> 拼接参数 -> 解析"],P=pt(()=>{if(w.spreadsheetUrl){const e=[...A];return e[0]+=`: ${w.spreadsheetUrl}`,e}return A});function z({content:e,row:t}){e&&(navigator.clipboard.writeText(e),E("copy",e,t),window.alert("复制成功"))}function E(e,t,a){const m=C.map?.default?.name;let i=localStorage.getItem("log_info");const k=`[${new Date().toLocaleString()}] - ${e} - ${a[m]?.value||t}`;i?i+=`; ${k}`:i=k,localStorage.setItem("log_info",i)}function $(){u.value=!0,h.value.length||Q(!1)}function tt(){const e={userAgent:navigator.userAgent},t=localStorage.getItem("log_info");return t&&(e.logInfo=t,localStorage.removeItem("log_info")),e}const et=tt();async function Q(e){h.value.length&&(h.value.length=0),v.value=!0;try{await U(e,et),await S({...C}),y.value&&(y.value="")}catch(t){console.log("拉取数据失败"),console.log(t),y.value="拉取数据失败, 请检查网络或联系管理员"}finally{v.value=!1}}function at(e,t){let a="--data-raw",m=e.lastIndexOf(a);if(m===-1&&(a="--data-binary",m=e.lastIndexOf(a)),m===-1)return;m+=a.length,t.type=K,t.part1=e.slice(0,m);let i=e.slice(m);const c=i.match(R);c&&(t.part3=i.slice(c.index),i=i.slice(0,c.index)),i=i.trim().slice(1,-1),t.part2=i}function st(e,t){const a="-Body";let m=e.lastIndexOf(a);if(m===-1)return;m+=a.length,t.type=Bt,t.part1=e.slice(0,m);let i=e.slice(m);const c=i.match(R);c&&(t.part3=i.slice(c.index),i=i.slice(0,c.index)),i=i.trim().slice(1,-1),t.part2=i}function ot(e,t){t.type=L;const a=e.match(/^fetch\((.*?)\);$/s);if(a){const i=a[1],c=i.indexOf(",");if(c!=-1){const k={url:i.slice(1,c-1),options:new Function(`return ${i.slice(c+1)}`)()};t.part1=k.url,t.part2=k.options.body,t.extra=k}}}function nt(){let e=o.value;if(!e){window.alert("请输入抓包参数");return}if(e.startsWith(K)?at(e,d):e.startsWith("Invoke-WebRequest")||e.startsWith("$session")?st(e,d):e.startsWith(L)&&ot(e,d),!d.part1||!d.part2)return window.alert("解析失败, 参数格式是否正确?");const t=d.part2.split("&");t.sort();const a={};for(const m of t){let[i,c]=m.split("=");if(i===N)if(c=decodeURIComponent(c),c.startsWith("[")){c=JSON.parse(c.replace(/\+/g,""));for(const k of c)k.unit=k.value/a[G]}else a.costUnit=c/a[G];a[i]=c}if(!a[G]&&!a[N]){window.alert("请输入正确的抓包参数");return}d.part2Parsed=a,l.value=!0,O.value=a[G]}function it(){let e=r.value;if(!e){window.alert("请输入兑换数量");return}if(e=e>>0,e<1){window.alert("请输入正确的兑换数量");return}let t="";const a={...d.part2Parsed};a[G]=e;let m;const i=a[N];Array.isArray(i)||(m=a.costUnit,delete a.costUnit);for(const c in a)if(c===N)if(m)t+=`${c}=${m*e}&`;else{const k=[];for(const M of i){const F={...M};F.value=""+M.unit*e,delete F.unit,k.push(F)}t+=`${c}=${encodeURIComponent(JSON.stringify(k))}&`}else t+=`${c}=${a[c]}&`;t=t.slice(0,-1),d.type===L?(n.value=`fetch('${d.part1}', ${JSON.stringify({...d.extra.options,body:t})});`,d.extra._params=t,b.value=!0):(n.value=`${d.part1} '${t}'`,d.part3&&(n.value+=` ${d.part3}`))}function lt(){n.value&&(navigator.clipboard.writeText(n.value),window.alert("复制成功"))}async function rt(){if(!b.value||I.value)return;I.value=!0,setTimeout(()=>{I.value=!1},5e3);const e=await fetch(d.extra.url,{...d.extra.options,body:d.extra._params});D.status_code=e.status;try{const t=await e.json();Object.assign(D,t)}catch(t){console.log(t);try{const a=await e.text();D.respText=a}catch(a){console.log(a)}D.message="请求失败, 网络或参数错误"}finally{x.value=!0}}function ct(){n.value&&(n.value=""),l.value&&(l.value=!1),o.value&&(o.value=""),b.value&&(b.value=!1)}return(e,t)=>(p(),f("div",Pt,[t[6]||(t[6]=s("p",{style:{"margin-bottom":"10px","font-size":"18px","font-weight":"500"}},"兑换参数转换器",-1)),t[7]||(t[7]=s("div",{style:{"margin-bottom":"5px",color:"rgb(133, 84, 84)","font-size":"14px"}},"基本使用方法: 解析 -> 生成 -> 复制 -> 粘贴[到终端] -> 执行",-1)),t[8]||(t[8]=s("div",{style:{"margin-bottom":"5px",color:"red","font-size":"12px"}},"注: 生成的命令不要直接复制, 而应该点击[复制]按钮, 否则会因换行符没复制出来, 导致命令执行失败",-1)),s("div",zt,[s("div",Nt,[t[4]||(t[4]=s("label",{for:"command",style:{display:"inline-block","margin-bottom":"5px"}}," 抓包数据: ",-1)),s("div",Zt,[V(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),placeholder:"请输入",id:"command",style:{width:"500px","margin-right":"10px"},rows:"6"},null,512),[[J,o.value]])]),s("div",Ft,[s("button",{onClick:$,style:{"margin-right":"10px"}},"浏览参数"),s("button",{onClick:nt,style:{"margin-right":"10px"}},"解析"),l.value?(p(),f("span",Lt," 成功, 当前兑换数量为: "+T(O.value),1)):j("",!0)])]),s("div",null,[t[5]||(t[5]=s("label",{for:"newAmount",style:{display:"inline-block","margin-bottom":"5px"}}," 兑换数量: ",-1)),s("div",Vt,[V(s("input",{type:"text",placeholder:"请输入",id:"newAmount",style:{"margin-right":"10px",height:"24px"},"onUpdate:modelValue":t[1]||(t[1]=a=>r.value=a)},null,512),[[J,r.value,void 0,{number:!0}]]),s("button",{onClick:it,style:{"margin-right":"10px",cursor:"pointer"}},"生成"),s("button",{onClick:lt,style:{"margin-right":"10px",cursor:"pointer"}},"复制"),s("button",{onClick:ct,style:{"margin-right":"10px",cursor:"pointer"}},"清除"),s("button",{disabled:!b.value||I.value,onClick:rt,style:vt({cursor:b.value&&!I.value?"pointer":"not-allowed"})},"执行",12,jt)])]),s("div",Qt,[s("div",{innerHTML:n.value},null,8,Mt)])]),t[9]||(t[9]=gt('<div>本工具需要提供原始的抓包数据，以下面的数据为例：</div><div style="font-size:13px;padding-left:10px;color:#855454;"><div>curl -X POST &#39;https://us.nkrpg.com/api/exchange/exchangeItem&#39; \\</div><div>-H &#39;Host: us.nkrpg.com&#39; \\</div><div>-H &#39;User-Agent: Mozilla/5.0...</div><div>-H &#39;Accept: */*&#39; \\</div><div>-H &#39;Content-Type: application/x-www-form-urlencoded&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE-TYPE: web&#39; \\</div><div>-H &#39;X-QOOKIA-DEVICE: 26bed0e5-e198-4a91-93f7-58a8597b4932&#39; \\</div><div>-H &#39;X-QOOKIA-SERVER-PREFIX: UVG&#39; \\</div><div>-H &#39;X-QOOKIA-USER: UVG0000009756&#39; \\</div><div> -H &#39;X-QOOKIA-DIGEST: 2ec453e2f13b0200b1cbd761dfc823b05dfd260d&#39; \\ </div><div>-H &#39;X-QOOKIA-PACK: 6a18fc16671e92d6a20655bd74ba1fd6c04bb4d1&#39; \\</div><div>...</div><div>--data-raw &#39;amount=2&amp;setting_id=539&amp;cost=%5B...%5D&#39;</div></div><div>将其复制到输入框内即可。</div><span style="color:red;font-size:12px;">(注意一定要包含兑换参数，如&quot;--data-raw&quot;, 或&quot;-Body&quot;)</span><div style="font-size:13px;">若是PowerShell, 则一般为: Invoke-WebRequest -UseBasicParsing -Uri &quot;https://us.nkrpg.com...,</div><div style="font-size:13px;">若是fetch, 则以fetch开头, 并且可直接在当前网页上执行</div>',6)),B(X,{visible:u.value,"onUpdate:visible":t[2]||(t[2]=a=>u.value=a),title:"兑换参数对照表",data:mt(h),description:P.value,onRefresh:Q,loading:v.value,error:y.value,onCopy:z},null,8,["visible","data","description","loading","error"]),B(X,{visible:x.value,"onUpdate:visible":t[3]||(t[3]=a=>x.value=a),title:"执行fetch命令",data1:D},null,8,["visible","data1"])]))}};export{Wt as default};
